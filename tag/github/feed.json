{
    "version": "https://jsonfeed.org/version/1",
    "title": "𝕺𝖚𝖗 𝕷𝖎𝖋𝖊 • All posts by \"github\" tag",
    "description": "记录生活 | 为众人抱薪者,不可使其扼于风雪",
    "home_page_url": "https://pangbai.work",
    "items": [
        {
            "id": "https://pangbai.work/IT/githubci/",
            "url": "https://pangbai.work/IT/githubci/",
            "title": "Github CI自动构建使用教程",
            "date_published": "2021-09-24T05:39:19.000Z",
            "content_html": "<p>可爱的 Github 为开发者们提供了一项名为 Github CI 的功能，帮助开发者在线构建各种项目，为构建耗时项目和没有构建设备的开发者提供帮助</p>\n<span id=\"more\"></span>\n<p>当一提到开源，每个人应该都会想到<s>白嫖</s>和全球最大的开源社区 - Github。自动构建作为免费开放的功能可谓非常好用。</p>\n<hr />\n<h3 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h3>\n<p>我找到一个开源的安卓 NDK 项目，但因为没有电脑，作为小白的我起初使用 AIDE 进行构建，安装了 ndk 支持后发现，构建出的东西没有 so 文件？重试很多次后我才知道，这东西不支持 Cmake?Cmake 是个啥？去问度娘后才得到答案。然后我开始考虑用 termux 容器运行 arch Linux 进行构建，安装 sdkman，安装 gradle，ndk 没有 arm 架构的？然后到处查找，在 github 上找到一个，搞过来用，好的，用不了。纯小白便开始迷茫。逛了逛 Github 想起来，不是还有 github ci 吗？以前也没怎么接触过这个，就开始试试吧。</p>\n<h3 id=\"教程\"><a class=\"anchor\" href=\"#教程\">#</a> 教程</h3>\n<p>条件</p>\n<ul>\n<li>一个 github 仓库</li>\n<li>对 git 操作流程有一定了解</li>\n<li>安装 git (手机请用 termux)</li>\n</ul>\n<h4 id=\"配置github\"><a class=\"anchor\" href=\"#配置github\">#</a> 配置 Github</h4>\n<p>仓库的建立和远程控制，网络上已经有了许多教程，在这里就不一一赘述了。<br />\n打开 Github 项目仓库页面，点击 Actions<br />\n 在这个页面寻找你需要构建的项目，展开更多后，可以找到 <code>Android Ci</code>  的选项，选择它。<br />\n可以看到如下页面，直接点击下面的  <code>Start commit</code></p>\n<p>打开终端，在你的项目文件夹初始化 git 仓库<br />\n使用 ssh 将当前仓库和 github 的仓库建立远程连接</p>\n<p>执行</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> pull</pre></td></tr></table></figure><p>把远程仓库文件同步过来<br />\n然后执行</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> .github/workflows</pre></td></tr></table></figure><p>进入自动构建的配置文件夹<br />\n然后对配置文件 <code>android.yml</code>  进行编辑</p>\n<ul>\n<li>把 java 版本更改为 8，以提高兼容</li>\n<li>确定你需要设置构建的项目文件地址，并且存在 gradlew (用于 gradle 构建)</li>\n<li>可以在 run 后面执行命令行，但不要用 cd 之类的指令，实测不能使用<br />\n_mulu<br />\n 构建完成后所有生成的文件都会被删除</li>\n<li>构建好后的文件可以通过 artifact 打包成 zip，在构建控制页面下载<br />\n以下为实例</li>\n</ul>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Android CI</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> master <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">pull_request</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> master <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 在 linux 上运行构建 (必要的话可以改为 windows)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># 初始化构建工具</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> set up JDK 8</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>java@v2</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token key atrule\">java-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'8'</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token key atrule\">distribution</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'adopt'</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span> gradle</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># 修改权限并进行构建</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Grant execute permission for gradlew</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> chmod +x gradlew</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build with Gradle</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> ./gradlew build</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\"># 查找构建好的文件      </span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\"># 这里为寻找.apk 和.aar 后缀文件的路径</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> find apk</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>  find ./ <span class=\"token punctuation\">-</span>regex \".<span class=\"token important\">*\\.apk\\|.*\\.aar\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>           </pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\"># 将构建好的含.apk 的文件上传</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Upload APK</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/upload<span class=\"token punctuation\">-</span>artifact@v2</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span>  ok</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> app/build/outputs/apk/debug/<span class=\"token important\">*.apk</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t  <span class=\"token comment\">#这里的 path 路径是来自于 find apk 那一步的结果</span></pre></td></tr></table></figure><p>修改完成后<br />\n将本地仓库推送 github，项目的自动构建就会按照配置文件运行<br />\n第一次构建成功可能因为路径问题不会上传 apk 文件</p>\n<p>这时我们需要去 github ci 的 log 页面，寻找 find apk 那一行查看 apk 所在路径<br />\n如果其输出路径为 app/build/outputs/apk/，就打开终端，把配置文件 upload APK 那一步的 path 改为<br />\n app/build/outputs/apk/*.apk。<br />\n保存文件重新将本地仓库推送到 github<br />\n 这次就可以得到构建好的 apk 了<br />\n<img data-src=\"http://shp.qpic.cn/collector/1642981619/8c8a9739-dbf2-412f-9d5e-7b0f6556ac42/0\" alt=\"githubci\" /></p>\n",
            "tags": [
                "Github"
            ]
        }
    ]
}