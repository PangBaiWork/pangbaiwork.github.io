{
    "version": "https://jsonfeed.org/version/1",
    "title": "𝕺𝖚𝖗 𝕷𝖎𝖋𝖊 • All posts by \"android\" tag",
    "description": "记录生活 | 为众人抱薪者,不可使其扼于风雪",
    "home_page_url": "https://pangbai.work",
    "items": [
        {
            "id": "https://pangbai.work/CTF/Reverse/Want2BecomeMagicalGirl/",
            "url": "https://pangbai.work/CTF/Reverse/Want2BecomeMagicalGirl/",
            "title": "Want2BecomeMagicalGirl出题笔记-WMCTF2025",
            "date_published": "2025-10-02T08:29:00.000Z",
            "content_html": "<p>WMCTF2025 的安卓 Reverse 出题笔记，你也想成为魔法少女吗？</p>\n<span id=\"more\"></span>\n<p>作为本次  <code>WMCTF2025</code>  的  <code>Reverse</code>  题目之一，因为害怕定位难做的人不多，我把此题目定位在 mid 难度（其实是我也不太确定难度捏，因为看懂了会很简单），直到比赛结束前的凌晨 2 点才出现了本题的唯一解（十分感谢这位师傅），解数也算是预料之中吧，不过居然成了本次解最少的 Re 题，我还是十分惭愧的。题目设计花了点时间导致 ddl 前没有写一篇详细的 WP 我十分抱歉，特此国庆回来写下这篇出题笔记，希望能对感兴趣的师傅有些许帮助，如果有不足之处还请师傅们在评论补充，十分感谢。</p>\n<h3 id=\"彩蛋部分\"><a class=\"anchor\" href=\"#彩蛋部分\">#</a> 彩蛋部分</h3>\n<p>本次题目设计了一个小彩蛋，做题的师傅们有没有发现了吗？Apk 安装后就会出现一整个桌面的魔法少女图标并且有不同的语录，不管点哪一个图标都是可以进入到题目页面的，通过任何一个图标卸载程序全部图标都会消失。<br />\n<img data-src=\"d1a4cd30c81bde3dc4fbc8fbc16afffc.jpeg\" alt=\"alt text\" /><br />\n 多图标只要在声明 activity 的时候为每个 activity 加上以下标签就行了</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>intent-filter</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>action</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.intent.action.MAIN<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>category</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.intent.category.LAUNCHER<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>intent-filter</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>比如</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>activity</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>theme</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@style/LaunchTheme<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Want2BecomeMagicalGirl<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>icon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@drawable/magical_girl<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>work.pangbai.magic.magical_girl.MainActivity<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>exported</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>launchMode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>singleTop<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>configChanges</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fontScale|layoutDirection|density|smallestScreenSize|screenSize|uiMode|screenLayout|orientation|keyboardHidden|keyboard|locale<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>windowSoftInputMode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>adjustResize<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>hardwareAccelerated</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta-data</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>io.flutter.embedding.android.NormalTheme<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@style/NormalTheme<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>intent-filter</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>action</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.intent.action.MAIN<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>category</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.intent.category.LAUNCHER<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>intent-filter</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>activity</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>activity</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>My magic is stronger than your darkness!<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>icon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@drawable/magical_girl<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>work.pangbai.magic.magical_girl.MainActivity1<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>exported</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>intent-filter</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>action</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.intent.action.MAIN<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>category</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.intent.category.LAUNCHER<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>intent-filter</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>activity</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>activity</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>In the name of the Moon, I<span class=\"token entity named-entity\" title=\"&apos;\">&amp;apos;</span>ll punish you!<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>icon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@drawable/magical_girl<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>work.pangbai.magic.magical_girl.MainActivity2<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>exported</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>intent-filter</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>action</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.intent.action.MAIN<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>category</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.intent.category.LAUNCHER<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>intent-filter</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>activity</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>activity</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Love and justice! Pretty sailor-suited soldier, Sailor Moon!<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>icon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@drawable/magical_girl<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>work.pangbai.magic.magical_girl.MainActivity3<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>exported</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>intent-filter</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>action</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.intent.action.MAIN<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>category</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.intent.category.LAUNCHER<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>intent-filter</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>activity</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>非主 Activity 的每个 Activity 申明一个类不写任何实现，就像这样</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">work<span class=\"token punctuation\">.</span>pangbai<span class=\"token punctuation\">.</span>magic<span class=\"token punctuation\">.</span>magical_girl</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainActivity1</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">MainActivity</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>再复制几个 Activity 之后不管点击哪个图标调转都会是第一个 MainActivity，这样就实现了多图标的效果，十分有趣。</p>\n<h3 id=\"题目架构\"><a class=\"anchor\" href=\"#题目架构\">#</a> 题目架构</h3>\n<p>题目使用 <code>flutter + native + Java</code>  实现，多少有点花哨但是流程还是很清晰的：  <code>Flutter输入-&gt;加载libnative.so-&gt;修改字节码-&gt;判断libart.so指定位置有没有被修改-&gt;魔改aes加密-&gt;魔改Java加密-&gt;Flutter判断密文</code> ，整个程序只涉及到 AES 和 XXTEA 加密，其实最核心的部分是对  <code>Java</code>  层代码的魔改。</p>\n<h3 id=\"flutter部分\"><a class=\"anchor\" href=\"#flutter部分\">#</a> Flutter 部分</h3>\n<p>第一部分在比赛进行的过程中就难倒了许多师傅， <code>Flutter</code>  框架写的题目在国内 CTF 比赛中不算常见，但是确实也出现过不少次了，比如 NepCTF2025，NKCTF2024，NewStarCTF2024 等等。这里逆向用到了项目 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3dvcmF3aXQvYmx1dHRlcg==\">blutter</span> 。<br />\n我推荐静态分析从 <code>blutter</code>  生成的 <code>asm</code>  开始入手，因为这里存在大部分代码结构和逻辑（几乎全部逻辑），而且同 IDA 分析的出的伪 C 代码不同，这里的类和函数是最清晰的，各种闭包的调用和字符串常量更是清晰可见 (在 IDA 中闭包可能是各种各样都基址 + 偏移调用)，IDA 只适合在 Hook 和调试时使用。<br />\n <code>blutter</code>  会生成 <code>asm/magical_girl</code>  文件夹下存在以下文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>目录: D:<span class=\"token punctuation\">\\</span>share<span class=\"token punctuation\">\\</span>出题<span class=\"token punctuation\">\\</span>WMCTF<span class=\"token punctuation\">\\</span>lib<span class=\"token punctuation\">\\</span>output<span class=\"token punctuation\">\\</span>asm<span class=\"token punctuation\">\\</span>magical_girl</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Mode                 LastWriteTime         Length Name</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>----                 -------------         ------ ----</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>-a----         <span class=\"token number\">2025</span>/10/3     <span class=\"token number\">17</span>:52         <span class=\"token number\">441492</span> aes_crypt_null_safe.dart</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>-a----         <span class=\"token number\">2025</span>/10/3     <span class=\"token number\">17</span>:52          <span class=\"token number\">70967</span> EditView.dart</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>-a----         <span class=\"token number\">2025</span>/10/3     <span class=\"token number\">17</span>:52          <span class=\"token number\">30221</span> main.dart</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>-a----         <span class=\"token number\">2025</span>/10/3     <span class=\"token number\">17</span>:52           <span class=\"token number\">3717</span> null_sub0.dart</pre></td></tr></table></figure><p>仅从做题者的角度出发，代码 <code>EditView.dart</code>  的 <code>check</code>  函数就是 <code>flutter</code>  层的 <code>check</code>  逻辑。<br />\n <code>blutter</code>  是很优秀的工具，但是代码中夹杂大量不存在高亮的 <code>ARM</code>  汇编，阅读还是十分头疼的，在 <code>ai</code>  兴起的这个时代靠肉眼分析还是太过落后了，这里我借助 <code>ai agent</code>  来快速分析代码（注意 <code>ai</code>  并不完全可信细节部分任然需要自己审查）。</p>\n<figure class=\"highlight dart\"><figcaption data-lang=\"dart\"><span>EditView.dart</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// lib: package:magical_girl/EditView.dart</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// 重新分析后的正确还原代码</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token string-literal\"><span class=\"token string\">'package:flutter/material.dart'</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token string-literal\"><span class=\"token string\">'package:flutter/services.dart'</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token string-literal\"><span class=\"token string\">'dart:convert'</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token string-literal\"><span class=\"token string\">'dart:typed_data'</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token string-literal\"><span class=\"token string\">'package:magical_girl/aes_crypt_null_safe.dart'</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token string-literal\"><span class=\"token string\">'package:magical_girl/null_sub0.dart'</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token string-literal\"><span class=\"token string\">'package:native_add/native_add.dart'</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyEditTextState</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">State</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">dynamic</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  late <span class=\"token class-name\">TextEditingController</span> _textController<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  late <span class=\"token class-name\">String</span> _displayText<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  late <span class=\"token keyword\">dynamic</span> _symmetricKey<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token metadata function\">@override</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token keyword\">void</span> <span class=\"token function\">initState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">initState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    _textController <span class=\"token operator\">=</span> <span class=\"token class-name\">TextEditingController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    _displayText <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"\"魔法で最低な人を消そう</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>Let's use magic to erase the worst people</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>用魔法将恶人全部抹消</pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>はぁ正直もうやめたい（はぁ）</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>Sigh... Honestly I want to quit sigh</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>唉 说真的已经累了（唉）</pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>魔法少女をやめたい（はぁ）</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>I want to stop being a magical girl sigh</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>不想再当魔法少女了（唉）</pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>自分ごと消えちゃってさようなら</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>Maybe I should disappear myself - goodbye</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>连同自己也一起抹除 永别了\"\"\"</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token metadata function\">@override</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token class-name\">Widget</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BuildContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Scaffold</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      appBar<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AppBar</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        title<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>          <span class=\"token string-literal\"><span class=\"token string\">\"Want2BecomeMagicalGirl ! ! !\"</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>          style<span class=\"token punctuation\">:</span> <span class=\"token class-name\">TextStyle</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            inherit<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            color<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Colors</span><span class=\"token punctuation\">.</span>blue<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        backgroundColor<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xFFFFB6C1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 粉色背景</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      body<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Container</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        padding<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\">EdgeInsets</span><span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token number\">16.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        child<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Center</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>          child<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Column</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>            mainAxisAlignment<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MainAxisAlignment</span><span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            mainAxisSize<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MainAxisSize</span><span class=\"token punctuation\">.</span>max<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            crossAxisAlignment<span class=\"token punctuation\">:</span> <span class=\"token class-name\">CrossAxisAlignment</span><span class=\"token punctuation\">.</span>center<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            children<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>              <span class=\"token comment\">// 文本输入框</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>              <span class=\"token class-name\">TextField</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                controller<span class=\"token punctuation\">:</span> _textController<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                decoration<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\">InputDecoration</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                  hintText<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Fill Magical Spell Here and Press enter...\"</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                  filled<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                textCapitalization<span class=\"token punctuation\">:</span> <span class=\"token class-name\">TextCapitalization</span><span class=\"token punctuation\">.</span>none<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                textAlign<span class=\"token punctuation\">:</span> <span class=\"token class-name\">TextAlign</span><span class=\"token punctuation\">.</span>left<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                obscureText<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                autocorrect<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                obscuringCharacter<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"•\"</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                enableSuggestions<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                autofocus<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                enableInteractiveSelection<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                maxLines<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                readOnly<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                onSubmitted<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> value<span class=\"token punctuation\">)</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                  <span class=\"token keyword\">await</span> <span class=\"token function\">_onTextSubmitted</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                cursorHeight<span class=\"token punctuation\">:</span> <span class=\"token number\">2.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                scrollPadding<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\">EdgeInsets</span><span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token number\">20.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                keyboardType<span class=\"token punctuation\">:</span> <span class=\"token class-name\">TextInputType</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                enableIMEPersonalizedLearning<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>              <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>              </pre></td></tr><tr><td data-num=\"85\"></td><td><pre>              <span class=\"token comment\">// 显示当前文本</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>              <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>                _displayText<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>                style<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\">TextStyle</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>                  inherit<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>                  color<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Colors</span><span class=\"token punctuation\">.</span>blue<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>              <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>              </pre></td></tr><tr><td data-num=\"94\"></td><td><pre>              <span class=\"token comment\">// 扩展的显示文本区域</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>              <span class=\"token class-name\">Expanded</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>                flex<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>                child<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>                  _displayText<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>                  style<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\">TextStyle</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>                    inherit<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>                    fontSize<span class=\"token punctuation\">:</span> <span class=\"token number\">16.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>                    fontWeight<span class=\"token punctuation\">:</span> <span class=\"token class-name\">FontWeight</span><span class=\"token punctuation\">.</span>bold<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>                  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>              <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>      resizeToAvoidBottomInset<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>      extendBody<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>      extendBodyBehindAppBar<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>  <span class=\"token comment\">// 文本提交处理</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>  <span class=\"token class-name\">Future</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">_onTextSubmitted</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> value<span class=\"token punctuation\">)</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>    <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>      <span class=\"token function\">check</span><span class=\"token punctuation\">(</span>_textController<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>      _textController<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>  <span class=\"token comment\">// 核心验证方法 - 这是关键逻辑</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>  <span class=\"token keyword\">void</span> <span class=\"token function\">check</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TextEditingController</span> controller<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> inputText<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>    <span class=\"token comment\">// 1. 初始化 AES 加密</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>    <span class=\"token keyword\">final</span> aesCrypt <span class=\"token operator\">=</span> <span class=\"token class-name\">AesCrypt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"129\"></td><td><pre>    <span class=\"token comment\">// 2. 创建两个不同的初始向量数组</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>int<span class=\"token punctuation\">></span></span> iv1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">126</span><span class=\"token punctuation\">,</span> <span class=\"token number\">70</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">426</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0x7E, 0x46, 0x06, 0x1AA</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>int<span class=\"token punctuation\">></span></span> iv2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">// 0x02, 0x02, 0x08, 0x0A</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"133\"></td><td><pre>    <span class=\"token comment\">// 3. 转换为 Uint8List</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>    <span class=\"token class-name\">Uint8List</span> ivBytes1 <span class=\"token operator\">=</span> <span class=\"token class-name\">Uint8List</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>    ivBytes1<span class=\"token punctuation\">.</span><span class=\"token function\">setRange</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> iv1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"137\"></td><td><pre>    <span class=\"token class-name\">Uint8List</span> ivBytes2 <span class=\"token operator\">=</span> <span class=\"token class-name\">Uint8List</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>    ivBytes2<span class=\"token punctuation\">.</span><span class=\"token function\">setRange</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> iv2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"140\"></td><td><pre>    <span class=\"token comment\">// 4. 获取对称密钥</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>    _symmetricKey <span class=\"token operator\">=</span> <span class=\"token function\">getSym</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"143\"></td><td><pre>    <span class=\"token comment\">// 5. 关键判断：检查对称密钥的第 7 个字节是否为 0xD6</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>    <span class=\"token keyword\">final</span> symBuffer <span class=\"token operator\">=</span> _symmetricKey<span class=\"token punctuation\">.</span><span class=\"token function\">asUint8List</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>    bool isSpecialKey <span class=\"token operator\">=</span> symBuffer<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">0xD6</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"147\"></td><td><pre>    <span class=\"token comment\">// 6. 根据密钥类型选择不同的处理路径</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>    <span class=\"token class-name\">Uint8List</span> finalKeyBytes<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isSpecialKey<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>      <span class=\"token comment\">// 特殊密钥路径：使用 ivBytes2</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>      <span class=\"token keyword\">final</span> keyData <span class=\"token operator\">=</span> <span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>int<span class=\"token punctuation\">></span></span> keyList <span class=\"token operator\">=</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>int<span class=\"token punctuation\">></span></span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>keyData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>      keyList<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>ivBytes2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>      finalKeyBytes <span class=\"token operator\">=</span> <span class=\"token class-name\">Uint8List</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromList</span><span class=\"token punctuation\">(</span>keyList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre>      <span class=\"token comment\">// 普通密钥路径：使用 ivBytes1</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>      <span class=\"token keyword\">final</span> keyData <span class=\"token operator\">=</span> <span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>int<span class=\"token punctuation\">></span></span> keyList <span class=\"token operator\">=</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>int<span class=\"token punctuation\">></span></span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>keyData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>      keyList<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>ivBytes1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre>      finalKeyBytes <span class=\"token operator\">=</span> <span class=\"token class-name\">Uint8List</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromList</span><span class=\"token punctuation\">(</span>keyList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"163\"></td><td><pre>    <span class=\"token comment\">// 7. 准备 AES 密钥 (32 字节，256 位)</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>int<span class=\"token punctuation\">></span></span> aesKeySequence <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre>      <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">14</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"166\"></td><td><pre>      <span class=\"token number\">18</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">22</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24</span><span class=\"token punctuation\">,</span> <span class=\"token number\">26</span><span class=\"token punctuation\">,</span> <span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>    <span class=\"token class-name\">Uint8List</span> aesKeyBytes <span class=\"token operator\">=</span> <span class=\"token class-name\">Uint8List</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>    aesKeyBytes<span class=\"token punctuation\">.</span><span class=\"token function\">setRange</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> aesKeySequence<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"171\"></td><td><pre>    <span class=\"token comment\">// 8. 设置 AES 加密参数</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre>    aesCrypt<span class=\"token punctuation\">.</span><span class=\"token function\">aesSetKeys</span><span class=\"token punctuation\">(</span>finalKeyBytes<span class=\"token punctuation\">,</span> aesKeyBytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre>    aesCrypt<span class=\"token punctuation\">.</span><span class=\"token function\">aesSetMode</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* 设置加密模式 */</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"175\"></td><td><pre>    <span class=\"token comment\">// 9. 对输入文本进行填充处理</span></pre></td></tr><tr><td data-num=\"176\"></td><td><pre>    <span class=\"token class-name\">String</span> paddedText <span class=\"token operator\">=</span> <span class=\"token function\">padToBlockSize</span><span class=\"token punctuation\">(</span>controller<span class=\"token punctuation\">,</span> inputText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"178\"></td><td><pre>    <span class=\"token comment\">// 10. UTF-8 编码</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre>    <span class=\"token keyword\">final</span> utf8Bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\">Utf8Encoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">convert</span><span class=\"token punctuation\">(</span>paddedText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"181\"></td><td><pre>    <span class=\"token comment\">// 11. AES 加密</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre>    <span class=\"token keyword\">final</span> encryptedBytes <span class=\"token operator\">=</span> aesCrypt<span class=\"token punctuation\">.</span><span class=\"token function\">aesEncrypt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Uint8List</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromList</span><span class=\"token punctuation\">(</span>utf8Bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"184\"></td><td><pre>    <span class=\"token comment\">// 12. 关键检查：验证对称密钥的特定位置</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre>    <span class=\"token keyword\">final</span> symData <span class=\"token operator\">=</span> _symmetricKey<span class=\"token punctuation\">.</span><span class=\"token function\">asUint8List</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre>    int checkByte <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>symData<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">>></span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token number\">0xD6</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 检查第 3 个字节的高位</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"188\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>checkByte <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre>      <span class=\"token comment\">// 如果检查通过，退出应用</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>      <span class=\"token class-name\">SystemNavigator</span><span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"193\"></td><td><pre>    <span class=\"token comment\">// 13. 转换为十六进制字符串</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre>    <span class=\"token class-name\">String</span> hexResult <span class=\"token operator\">=</span> <span class=\"token function\">uint8ListToHex</span><span class=\"token punctuation\">(</span>controller<span class=\"token punctuation\">,</span> encryptedBytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"196\"></td><td><pre>    <span class=\"token comment\">// 14. 发送结果并处理响应</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre>    <span class=\"token function\">send</span><span class=\"token punctuation\">(</span>hexResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"198\"></td><td><pre>      <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"199\"></td><td><pre>        <span class=\"token comment\">// 检查响应是否为特定的成功字符串</span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response <span class=\"token operator\">==</span> <span class=\"token string-literal\"><span class=\"token string\">\"8sAFX45zT7uc0vSUyFNNly1h/d5zTt89tV3kcVr5P5n7lRKPyYtxg31zYNB2lPV0c5nf/x2/IK94XV9Ufs9XfaDG5IXxMlZy+Z2nE+ZZRFBSpMoKzQXfUq2TSjJJfQxV\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre>          _displayText <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"You have become a magical girl ! !\"</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre>          _displayText <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"This spell has no magic power\"</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"204\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"205\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre></pre></td></tr><tr><td data-num=\"209\"></td><td><pre>  <span class=\"token comment\">// 填充文本到块大小（PKCS7 填充）</span></pre></td></tr><tr><td data-num=\"210\"></td><td><pre>  <span class=\"token class-name\">String</span> <span class=\"token function\">padToBlockSize</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TextEditingController</span> controller<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> text<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre>    <span class=\"token keyword\">const</span> int blockSize <span class=\"token operator\">=</span> <span class=\"token number\">16</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// AES 块大小</span></pre></td></tr><tr><td data-num=\"212\"></td><td><pre>    int textLength <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"213\"></td><td><pre>    int paddingLength <span class=\"token operator\">=</span> blockSize <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>textLength <span class=\"token operator\">&amp;</span> <span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// textLength % 16</span></pre></td></tr><tr><td data-num=\"214\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"215\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>paddingLength <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"216\"></td><td><pre>      paddingLength <span class=\"token operator\">=</span> <span class=\"token number\">16</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 如果已经是 16 的倍数，仍需填充 16 字节</span></pre></td></tr><tr><td data-num=\"217\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"218\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"219\"></td><td><pre>    <span class=\"token comment\">// 创建填充字符数组</span></pre></td></tr><tr><td data-num=\"220\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>int<span class=\"token punctuation\">></span></span> paddingChars <span class=\"token operator\">=</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span>paddingLength<span class=\"token punctuation\">,</span> paddingLength <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"221\"></td><td><pre>    <span class=\"token class-name\">String</span> paddingString <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromCharCodes</span><span class=\"token punctuation\">(</span>paddingChars<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"222\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"223\"></td><td><pre>    <span class=\"token keyword\">return</span> text <span class=\"token operator\">+</span> paddingString<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"224\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"225\"></td><td><pre></pre></td></tr><tr><td data-num=\"226\"></td><td><pre>  <span class=\"token comment\">// 将 Uint8List 转换为十六进制字符串</span></pre></td></tr><tr><td data-num=\"227\"></td><td><pre>  <span class=\"token class-name\">String</span> <span class=\"token function\">uint8ListToHex</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TextEditingController</span> controller<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Uint8List</span> bytes<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"228\"></td><td><pre>    <span class=\"token keyword\">return</span> bytes<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>byte<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> byte<span class=\"token punctuation\">.</span><span class=\"token function\">toRadixString</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">padLeft</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string-literal\"><span class=\"token string\">'0'</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"229\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"230\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"231\"></td><td><pre></pre></td></tr><tr><td data-num=\"232\"></td><td><pre><span class=\"token comment\">// 主应用入口</span></pre></td></tr><tr><td data-num=\"233\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">MagicalGirlEditApp</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">StatelessWidget</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"234\"></td><td><pre>  <span class=\"token keyword\">const</span> <span class=\"token class-name\">MagicalGirlEditApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token class-name\">Key</span><span class=\"token operator\">?</span> key<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">:</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"235\"></td><td><pre></pre></td></tr><tr><td data-num=\"236\"></td><td><pre>  <span class=\"token metadata function\">@override</span></pre></td></tr><tr><td data-num=\"237\"></td><td><pre>  <span class=\"token class-name\">Widget</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BuildContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"238\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token class-name\">MaterialApp</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"239\"></td><td><pre>      title<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">'Magical Girl Editor'</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"240\"></td><td><pre>      theme<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ThemeData</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"241\"></td><td><pre>        primarySwatch<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Colors</span><span class=\"token punctuation\">.</span>pink<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"242\"></td><td><pre>        visualDensity<span class=\"token punctuation\">:</span> <span class=\"token class-name\">VisualDensity</span><span class=\"token punctuation\">.</span>adaptivePlatformDensity<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"243\"></td><td><pre>      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"244\"></td><td><pre>      home<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\">MyEditTextState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"245\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"246\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"247\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"248\"></td><td><pre></pre></td></tr><tr><td data-num=\"249\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"250\"></td><td><pre>  <span class=\"token function\">runApp</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token class-name\">MagicalGirlEditApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"251\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>看到结果的时候连自己都吓到了，和源代码居然十分接近（如果更高级的 <code>ai</code>  应该就能 <code>FullCombo</code>  了），如果只分析大概逻辑，这个输出已经完全够用了。</p>\n<p>基于此结果开始我们的分析， <code>check</code>  函数调用了一个 AES 加密， <code>aesSetKeys</code>  调用有两个参数，我使用的 <code>ai</code>  貌似这两个参数都猜成 key 了 ( <code>finalKeyBytes, aesKeyBytes</code> ，有钱的老板用 <code>GPT5</code>  肯定不会出现这种情况吧)， <code>AES</code>  有的两个加密参数，可能是 <code>KEY</code>  和 <code>IV</code>  常见为 16 字节，这边加密模式没分析出来，我们回原文看看也没能看到参数，可以先放一下。</p>\n<p><code>aesKeyBytes</code>  来自静态数组 <code>[2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32]</code>  刚好 16 位，但是都是 2 的倍数，  <code>keyBytes</code>  来自两个 <code>list</code>  拼接 ( <code>addAll</code> )，其中一部分在选自静态数组 <code>[2, 2, 8, 10]</code> , <code>[126, 70, 6, 426]</code>  另一部分来自 <code>getKey</code> ， 可以察觉到不对了，AES 传入的密钥都是 byte 类型，但是这里有数据超过 255，并且不存在奇数，除 2 之后 <code>[1,1,4,5]</code> ，瞬间可以要素察觉了，这里的所有 byte 都是左移 1 位的。同时 <code>finalKeyBytes</code>  的最终值取决于 <code>getSym</code>  返回的第八位是否等于 <code>0xD6</code> 。</p>\n<p>再来分析加密代码，查看 <code>aes_crypt_null_safe.dart</code>  的 <code>_sBox</code>  函数 (为什么要看这个？因为这属于常见魔改项吧，都位于 <code>magical_girl</code>  目录下了，肯定不会是标准加密了)。</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">0x2903a0</span><span class=\"token operator\">:</span> mov             x17<span class=\"token punctuation\">,</span> #<span class=\"token number\">0xf6</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     <span class=\"token number\">0x2903a4</span><span class=\"token operator\">:</span> StoreField<span class=\"token operator\">:</span> r0<span class=\"token operator\">-></span>field_13 <span class=\"token operator\">=</span> r17</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token number\">0x2903a4</span><span class=\"token operator\">:</span> stur            w17<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>x0<span class=\"token punctuation\">,</span> #<span class=\"token number\">0x13</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     <span class=\"token number\">0x2903a8</span><span class=\"token operator\">:</span> r17 <span class=\"token operator\">=</span> <span class=\"token number\">48</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token number\">0x2903a8</span><span class=\"token operator\">:</span> mov             x17<span class=\"token punctuation\">,</span> #<span class=\"token number\">0x30</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     <span class=\"token number\">0x2903ac</span><span class=\"token operator\">:</span> ArrayStore<span class=\"token operator\">:</span> r0<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> r17  <span class=\"token punctuation\">;</span> List_4</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token number\">0x2903ac</span><span class=\"token operator\">:</span> stur            w17<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>x0<span class=\"token punctuation\">,</span> #<span class=\"token number\">0x17</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     <span class=\"token number\">0x2903b0</span><span class=\"token operator\">:</span> r17 <span class=\"token operator\">=</span> <span class=\"token number\">334</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token number\">0x2903b0</span><span class=\"token operator\">:</span> mov             x17<span class=\"token punctuation\">,</span> #<span class=\"token number\">0x14e</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     <span class=\"token number\">0x2903b4</span><span class=\"token operator\">:</span> StoreField<span class=\"token operator\">:</span> r0<span class=\"token operator\">-></span>field_1b <span class=\"token operator\">=</span> r17</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>         <span class=\"token number\">0x2903b4</span><span class=\"token operator\">:</span> stur            w17<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>x0<span class=\"token punctuation\">,</span> #<span class=\"token number\">0x1b</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     <span class=\"token number\">0x2903b8</span><span class=\"token operator\">:</span> r17 <span class=\"token operator\">=</span> <span class=\"token number\">132</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         <span class=\"token number\">0x2903b8</span><span class=\"token operator\">:</span> mov             x17<span class=\"token punctuation\">,</span> #<span class=\"token number\">0x84</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     <span class=\"token number\">0x2903bc</span><span class=\"token operator\">:</span> StoreField<span class=\"token operator\">:</span> r0<span class=\"token operator\">-></span>field_1f <span class=\"token operator\">=</span> r17</pre></td></tr></table></figure><p>有很多存储常量操作，算一下刚好 256 个，这就是 SBOX，这里的数据也是左移一位的，扣出来就可以写逆盒了。<br />\n <code>aes_crypt_null_safe.dart</code>  同样可以 <code>ai</code>  还原，但是这部分出现 <code>ai</code>  幻觉太严重了，网上有开源算法引导 <code>ai</code>  输出标准结果。用静态分析还可以分析出第二处魔改。</p>\n<figure class=\"highlight dart\"><figcaption data-lang=\"dart\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">0x28d728</span><span class=\"token punctuation\">:</span> cmp             x1<span class=\"token punctuation\">,</span> x3</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     <span class=\"token number\">0x28d72c</span><span class=\"token punctuation\">:</span> b<span class=\"token punctuation\">.</span>ge            #<span class=\"token number\">0x28d770</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     <span class=\"token number\">0x28d730</span><span class=\"token punctuation\">:</span> str             x0<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>SP<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     <span class=\"token number\">0x28d734</span><span class=\"token punctuation\">:</span> r0 <span class=\"token operator\">=</span> <span class=\"token function\">_subBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token number\">0x28d734</span><span class=\"token punctuation\">:</span> bl              #<span class=\"token number\">0x2901b8</span>  <span class=\"token punctuation\">;</span> <span class=\"token punctuation\">[</span>package<span class=\"token punctuation\">:</span>magical_girl<span class=\"token operator\">/</span>aes_crypt_null_safe<span class=\"token punctuation\">.</span>dart<span class=\"token punctuation\">]</span> _Aes<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>_subBytes</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     <span class=\"token number\">0x28d738</span><span class=\"token punctuation\">:</span> ldr             x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token number\">0x18</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     <span class=\"token number\">0x28d73c</span><span class=\"token punctuation\">:</span> str             x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>SP<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     <span class=\"token number\">0x28d740</span><span class=\"token punctuation\">:</span> r0 <span class=\"token operator\">=</span> <span class=\"token function\">_shiftRows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token number\">0x28d740</span><span class=\"token punctuation\">:</span> bl              #<span class=\"token number\">0x28ffb4</span>  <span class=\"token punctuation\">;</span> <span class=\"token punctuation\">[</span>package<span class=\"token punctuation\">:</span>magical_girl<span class=\"token operator\">/</span>aes_crypt_null_safe<span class=\"token punctuation\">.</span>dart<span class=\"token punctuation\">]</span> _Aes<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>_shiftRows</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     <span class=\"token number\">0x28d744</span><span class=\"token punctuation\">:</span> ldr             x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token number\">0x18</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     <span class=\"token number\">0x28d748</span><span class=\"token punctuation\">:</span> str             x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>SP<span class=\"token punctuation\">,</span> #<span class=\"token number\">8</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     <span class=\"token number\">0x28d74c</span><span class=\"token punctuation\">:</span> ldur            x0<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token operator\">-</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     <span class=\"token number\">0x28d750</span><span class=\"token punctuation\">:</span> str             x0<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>SP<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     <span class=\"token number\">0x28d754</span><span class=\"token punctuation\">:</span> r0 <span class=\"token operator\">=</span> <span class=\"token function\">_addRoundKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>         <span class=\"token number\">0x28d754</span><span class=\"token punctuation\">:</span> bl              #<span class=\"token number\">0x291204</span>  <span class=\"token punctuation\">;</span> <span class=\"token punctuation\">[</span>package<span class=\"token punctuation\">:</span>magical_girl<span class=\"token operator\">/</span>aes_crypt_null_safe<span class=\"token punctuation\">.</span>dart<span class=\"token punctuation\">]</span> _Aes<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>_addRoundKey</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>     <span class=\"token number\">0x28d758</span><span class=\"token punctuation\">:</span> ldr             x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token number\">0x18</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>     <span class=\"token number\">0x28d75c</span><span class=\"token punctuation\">:</span> str             x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>SP<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>     <span class=\"token number\">0x28d760</span><span class=\"token punctuation\">:</span> r0 <span class=\"token operator\">=</span> <span class=\"token function\">_mixColumns</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>         <span class=\"token number\">0x28d760</span><span class=\"token punctuation\">:</span> bl              #<span class=\"token number\">0x28d8b0</span>  <span class=\"token punctuation\">;</span> <span class=\"token punctuation\">[</span>package<span class=\"token punctuation\">:</span>magical_girl<span class=\"token operator\">/</span>aes_crypt_null_safe<span class=\"token punctuation\">.</span>dart<span class=\"token punctuation\">]</span> _Aes<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>_mixColumns</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>     <span class=\"token number\">0x28d764</span><span class=\"token punctuation\">:</span> ldur            x0<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token operator\">-</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     <span class=\"token number\">0x28d768</span><span class=\"token punctuation\">:</span> add             x1<span class=\"token punctuation\">,</span> x0<span class=\"token punctuation\">,</span> #<span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     <span class=\"token number\">0x28d76c</span><span class=\"token punctuation\">:</span> b               #<span class=\"token number\">0x28d6f8</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     <span class=\"token number\">0x28d770</span><span class=\"token punctuation\">:</span> mov             x0<span class=\"token punctuation\">,</span> x1</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     <span class=\"token number\">0x28d774</span><span class=\"token punctuation\">:</span> ldur            x1<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token operator\">-</span><span class=\"token number\">0x20</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>     <span class=\"token number\">0x28d778</span><span class=\"token punctuation\">:</span> ldr             x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token number\">0x18</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>     <span class=\"token number\">0x28d77c</span><span class=\"token punctuation\">:</span> str             x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>SP<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>轮密钥加密和列混淆交换位置，很常见的魔改。接下来通过调试消去不确定因素。</p>\n<p>不知道大家是否有发现 <code>IDA</code>  分析的汇编结果和 <code>blutter</code>  解析结果有出入</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>blutter<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token number\">0x28c25c</span><span class=\"token operator\">:</span> ldur            x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token operator\">-</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token number\">0x28c260</span><span class=\"token operator\">:</span> str             x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>SP<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token number\">0x28c264</span><span class=\"token operator\">:</span> r0 <span class=\"token operator\">=</span> <span class=\"token function\">aesSetMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>IDA<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token number\">0x28C25C</span>                  LDUR            X16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>X29<span class=\"token punctuation\">,</span>#<span class=\"token operator\">-</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token number\">0x28C260</span>                  STR             X16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>X15<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token number\">0x28C264</span>                  BL              magical_girl$aes_crypt_null_safe_AesCrypt__aesSetMode_291548</pre></td></tr></table></figure><p>对于 <code>x29</code>  寄存器，熟悉 <code>arm</code>  的朋友都知道，指的就是 <code>fp</code>  寄存器。但是对于 <code>x15</code>  寄存器来说，这个寄存器和 <code>sp</code>  并没有什么关系（ <code>arm</code>  的 <code>sp</code>  是 <code>x31</code>  寄存器）。说明 <code>flutter</code>  函数的调用并非标准调用，事实上从 <code>blutter</code>  生成的 <code>blutter_frida.js</code>  便可以看出端倪，</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> PointerCompressedEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> CompressedWordSize <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> HeapAddressReg <span class=\"token operator\">=</span> <span class=\"token string\">'x28'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> NullReg <span class=\"token operator\">=</span> <span class=\"token string\">'x22'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">const</span> StackReg <span class=\"token operator\">=</span> <span class=\"token string\">'x15'</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>栈指针被定义为 x15，这个 x15 几乎不会被程序修改，，这里用作栈指针也尚可。<br />\n同时 <code>blutter_frida.js</code>  还存在以下代码，说明，传参是通过栈进行的。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">getArg</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">context<span class=\"token punctuation\">,</span> idx</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// Note: argument pointer is never compressed</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">let</span> stack <span class=\"token operator\">=</span> context<span class=\"token punctuation\">[</span>StackReg<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">return</span> stack<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span> <span class=\"token operator\">*</span> idx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">readPointer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>IDA</code>  把函数分析为 <code>fastcall</code>  调用约定，并不适用于 <code>Flutter</code>  函数，所以反编译结果十分丑陋。我们这里可以来借用 <code>blutter_frida.js</code>  分析一下传参规则。</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">0x28c244</span><span class=\"token operator\">:</span> ldur            x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token operator\">-</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token number\">0x28c248</span><span class=\"token operator\">:</span> ldur            lr<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token operator\">-</span><span class=\"token number\">0x18</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token number\">0x28c24c</span><span class=\"token operator\">:</span> stp             lr<span class=\"token punctuation\">,</span> x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>SP<span class=\"token punctuation\">,</span> #<span class=\"token number\">8</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token number\">0x28c250</span><span class=\"token operator\">:</span> ldur            x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token operator\">-</span><span class=\"token number\">0x20</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token number\">0x28c254</span><span class=\"token operator\">:</span> str             x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>SP<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token number\">0x28c258</span><span class=\"token operator\">:</span> r0 <span class=\"token operator\">=</span> <span class=\"token function\">aesSetKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token number\">0x28c258</span><span class=\"token operator\">:</span> bl              #<span class=\"token number\">0x2915a4</span>  <span class=\"token punctuation\">;</span> <span class=\"token punctuation\">[</span>package<span class=\"token operator\">:</span>magical_girl<span class=\"token operator\">/</span>aes_crypt_null_safe<span class=\"token punctuation\">.</span>dart<span class=\"token punctuation\">]</span> AesCrypt<span class=\"token operator\">::</span>aesSetKeys</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token number\">0x28c25c</span><span class=\"token operator\">:</span> ldur            x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token operator\">-</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token number\">0x28c260</span><span class=\"token operator\">:</span> str             x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>SP<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token number\">0x28c264</span><span class=\"token operator\">:</span> r0 <span class=\"token operator\">=</span> <span class=\"token function\">aesSetMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token number\">0x28c264</span><span class=\"token operator\">:</span> bl              #<span class=\"token number\">0x291548</span>  <span class=\"token punctuation\">;</span> <span class=\"token punctuation\">[</span>package<span class=\"token operator\">:</span>magical_girl<span class=\"token operator\">/</span>aes_crypt_null_safe<span class=\"token punctuation\">.</span>dart<span class=\"token punctuation\">]</span> AesCrypt<span class=\"token operator\">::</span>aesSetMode</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token number\">0x28c268</span><span class=\"token operator\">:</span> ldr             x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token number\">0x18</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token number\">0x28c26c</span><span class=\"token operator\">:</span> ldr             lr<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token number\">0x10</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token number\">0x28c270</span><span class=\"token operator\">:</span> stp             lr<span class=\"token punctuation\">,</span> x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>SP<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token number\">0x28c288</span><span class=\"token operator\">:</span> ldur            x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fp<span class=\"token punctuation\">,</span> #<span class=\"token operator\">-</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token number\">0x28c28c</span><span class=\"token operator\">:</span> stp             x0<span class=\"token punctuation\">,</span> x16<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>SP<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token number\">0x28c290</span><span class=\"token operator\">:</span> r0 <span class=\"token operator\">=</span> <span class=\"token function\">aesEncrypt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>首先， <code>aesSetKeys()</code>  传入了两个参数，一个是 <code>key</code> , 一个是 <code>iv</code> , 我们通过以下修改来 <code>hook</code>  调用参数</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 使弹窗可关闭</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Java<span class=\"token punctuation\">.</span><span class=\"token function\">perform</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> Java<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"android.widget.Button\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    a<span class=\"token punctuation\">[</span><span class=\"token string\">\"setEnabled\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">implementation</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">enable</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Button set enable\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"setEnabled\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">const</span> ShowNullField <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">const</span> MaxDepth <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">var</span> libapp <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">onLibappLoaded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">// xxx(\"remove this line and correct the hook value\");</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">const</span> fn_addr <span class=\"token operator\">=</span> <span class=\"token number\">0x2915a4</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    Interceptor<span class=\"token punctuation\">.</span><span class=\"token function\">attach</span><span class=\"token punctuation\">(</span>libapp<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>fn_addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token function-variable function\">onEnter</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">let</span> objPtr <span class=\"token operator\">=</span> <span class=\"token function\">getArg</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>tptr<span class=\"token punctuation\">,</span> cls<span class=\"token punctuation\">,</span> values<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">getTaggedObjectValue</span><span class=\"token punctuation\">(</span>objPtr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>cls<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">@</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>tptr<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\"> =</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>getArg(this.context, 0)</code>  更改第二个参数控制传参打印位置</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>frida -U -f work.pangbai.magic.magical_girl -l blutter_frida.js</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     ____</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    / _  |   Frida <span class=\"token number\">16.6</span>.<span class=\"token number\">6</span> - A world-class dynamic instrumentation toolkit</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   | (_| |</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    > _  |   Commands<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   /_/ |_|       help      -> Displays the help system</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   . . . .       object?   -> Display information about 'object'</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   . . . .       exit/quit -> Exit</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   . . . .</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   . . . .   More info at https<span class=\"token operator\">:</span><span class=\"token comment\">//frida.re/docs/home/</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   . . . .</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   . . . .   Connected to Android Emulator <span class=\"token number\">5554</span> (id=emulator<span class=\"token number\">-5554</span>)</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Spawned `work.pangbai.magic.magical_girl`. Resuming main thread!        </pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>Android Emulator <span class=\"token number\">5554</span><span class=\"token operator\">:</span><span class=\"token operator\">:</span>work.pangbai.magic.magical_girl <span class=\"token punctuation\">]</span>-> Button set enable</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>_Uint8List@7b00721419 = <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token number\">6</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token number\">7</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token number\">8</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token number\">9</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token number\">10</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token number\">11</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token number\">12</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token number\">13</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token number\">14</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token number\">15</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token number\">16</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>Process terminated</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">[</span>Android Emulator <span class=\"token number\">5554</span><span class=\"token operator\">:</span><span class=\"token operator\">:</span>work.pangbai.magic.magical_girl <span class=\"token punctuation\">]</span>-></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>Thank you for using Frida!</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>> frida -U -f work.pangbai.magic.magical_girl -l blutter_frida.js</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>     ____</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    / _  |   Frida <span class=\"token number\">16.6</span>.<span class=\"token number\">6</span> - A world-class dynamic instrumentation toolkit</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>   | (_| |</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    > _  |   Commands<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>   /_/ |_|       help      -> Displays the help system</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>   . . . .       object?   -> Display information about 'object'</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>   . . . .       exit/quit -> Exit</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>   . . . .</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>   . . . .   More info at https<span class=\"token operator\">:</span><span class=\"token comment\">//frida.re/docs/home/</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>   . . . .</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>   . . . .   Connected to Android Emulator <span class=\"token number\">5554</span> (id=emulator<span class=\"token number\">-5554</span>)</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>Spawned `work.pangbai.magic.magical_girl`. Resuming main thread!        </pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">[</span>Android Emulator <span class=\"token number\">5554</span><span class=\"token operator\">:</span><span class=\"token operator\">:</span>work.pangbai.magic.magical_girl <span class=\"token punctuation\">]</span>-> Button set enable</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>_Uint8List@7b0071a079 = <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token number\">122</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token number\">37</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  <span class=\"token number\">197</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token number\">36</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token number\">198</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  <span class=\"token number\">51</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>  <span class=\"token number\">76</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>  <span class=\"token number\">48</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  <span class=\"token number\">243</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  <span class=\"token number\">98</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>  <span class=\"token number\">175</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>  <span class=\"token number\">172</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>  <span class=\"token number\">63</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>  <span class=\"token number\">35</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>  <span class=\"token number\">213</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>Process terminated</pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token punctuation\">[</span>Android Emulator <span class=\"token number\">5554</span><span class=\"token operator\">:</span><span class=\"token operator\">:</span>work.pangbai.magic.magical_girl <span class=\"token punctuation\">]</span>-></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>Thank you for using Frida!</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>> frida -U -f work.pangbai.magic.magical_girl -l blutter_frida.js</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>     ____</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    / _  |   Frida <span class=\"token number\">16.6</span>.<span class=\"token number\">6</span> - A world-class dynamic instrumentation toolkit</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>   | (_| |</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    > _  |   Commands<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>   /_/ |_|       help      -> Displays the help system</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>   . . . .       object?   -> Display information about 'object'</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>   . . . .       exit/quit -> Exit</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>   . . . .</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>   . . . .   More info at https<span class=\"token operator\">:</span><span class=\"token comment\">//frida.re/docs/home/</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>   . . . .</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>   . . . .   Connected to Android Emulator <span class=\"token number\">5554</span> (id=emulator<span class=\"token number\">-5554</span>)</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>Spawned `work.pangbai.magic.magical_girl`. Resuming main thread!        </pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token punctuation\">[</span>Android Emulator <span class=\"token number\">5554</span><span class=\"token operator\">:</span><span class=\"token operator\">:</span>work.pangbai.magic.magical_girl <span class=\"token punctuation\">]</span>-> Button set enable</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>Unhandle class id<span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> Sentinel</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>Unhandle class id<span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> Sentinel</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>Unhandle class id<span class=\"token operator\">:</span> <span class=\"token number\">85</span><span class=\"token punctuation\">,</span> Map</pre></td></tr><tr><td data-num=\"90\"></td><td><pre>AesCrypt@7b006f6bb9 = <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>  <span class=\"token property\">\"off_8!_Aes@7b006f6bc9\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>    <span class=\"token property\">\"off_8!Sentinel@7b00008301\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Unhandle class id: 30, Sentinel\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>    <span class=\"token property\">\"off_10!Sentinel@7b00008301\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Unhandle class id: 30, Sentinel\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>    <span class=\"token property\">\"off_14!List@7b006f6bf9\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>        <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>          <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>        <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>          <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>        <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>          <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>        <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>          <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>    <span class=\"token property\">\"off_18!AesMode@7b0045a1d1\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>      <span class=\"token property\">\"parent!_Enum\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>        <span class=\"token property\">\"off_8\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>        <span class=\"token property\">\"off_10!String@7b000f45e1\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cbc\"</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>    <span class=\"token property\">\"off_1c!_Uint8List@7b006f6c99\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>    <span class=\"token property\">\"off_20!_Uint8List@7b006f6cb9\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>  <span class=\"token property\">\"off_c!Map@7b006f6da9\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Unhandle class id: 85, Map\"</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>Process terminated</pre></td></tr></table></figure><p>对 <code>aesSetMode</code>  和 <code>aesEncrypt_28c6a8</code>  故技重施，也可找到输入的 <code>flag</code>  数据（ <code>aesEncrypt_28c6a8</code>  都第一个参数），便发现 <code>Flutter</code>  函数调用约定:<br />\n <code>参数从右往左入栈，最后入栈对象的this指针</code> 。到此处 <code>Flutter</code>  逆向便已经变得十分简单了， <code>IDA</code>  的那些错误的入参分析变得毫无价值。<br />\n将打印参数改为对象 <code>this</code>  指针 ( <code>Hook</code>  点必须在 <code>aesSetMode</code>  的后面，不然拿到的输出是 <code>cbc</code> )，我们可以看到 <code>AES</code>  加密模式：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"off_18!AesMode@7b0045a1d1\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      <span class=\"token property\">\"parent!_Enum\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"off_8\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token property\">\"off_10!String@7b000f45e1\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ecb\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p><code>key</code>  在 <code>aesSetKeys</code>  也直接打印出来了，接下来只要 <code>Hook</code>  调试各个步骤看看加密的魔改情况就行了。加密是 <code>AES ecb</code>  加密， <code>IV</code>  失去了作用。<br />\n到此 <code>Flutter</code>  层就分析完毕了，是不是很简单呢，哈哈哈。</p>\n<h3 id=\"native构思\"><a class=\"anchor\" href=\"#native构思\">#</a> Native 构思</h3>\n<p>我认为简单的 Flutter 逆向拿出来给师傅们看，还是太草率了，多少有点难登大雅之堂，真正好的题目，出题人花费的时间远会比做题人花费的时间长。</p>\n<p><code>Native</code>  首先要介绍一下 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zb3VyY2UuYW5kcm9pZC5nb29nbGUuY24vZG9jcy9jb3JlL3Blcm1pc3Npb25zL25hbWVzcGFjZXNfbGlicmFyaWVzP2hsPXpoLWNu\">安卓原生库的命名空间</span><br />\n <code>Android 7.0</code>  为原生库引入了命名空间，以限制内部 API 的可见性，听起来很高大上，具体解释就是安卓上的动态链接库使用被约束了，普通开发者不管是编译时链接还是使用 <code>dlsym</code>  都不能获取到被限制的 lib 的符号地址， <code>native</code>  开发能调用的 <code>api</code>  被严重限制，同理 <code>Java</code>  也有类似的约束 <code>hiddenapi</code>  用来限制反射的功能。</p>\n<p>本题目使用 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NzcmxpdmUvZmFrZS1kbGZjbg==\">fake-dlfcn</span> 来查找调用  <code>libart.so</code>  的符号，同时修改了一些代码来适配高版本安卓。这个项目原理比较简单，扫描 <code>proc/self/maps</code>  得到原生库的基址，并通过解析原生库的 <code>elf</code>  符号表得到偏移，再进行计算得到符号地址。</p>\n<p>题目使用的 <code>inlineHook</code>  的 <code>shellcode</code>  来自<a href=\"https://gitee.com/zzy_cs/inline-hook\"> inlineHook<br />\n</a></p>\n<p>接下来可以看 <code>native</code>  了， <code>libnative_add.so</code>  在 <code>Flutter</code>  输入框回车的时候被加载。 <code>genKey</code>  函数是一个 <code>rc4</code>  用来生成静态的 <code>Key</code> ，通过 <code>blutter</code>  生成的代码可以知道这个函数被 <code>flutter</code>  的 <code>getKey()</code>  调用没有什么需要细说的。 <code>getSym</code>  函数被 <code>flutter</code>  的 <code>getSym</code>  函数调用。其伪代码如下</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>__int64 __fastcall <span class=\"token function\">getSym</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>a1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  __int64 result<span class=\"token punctuation\">;</span> <span class=\"token comment\">// x0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  result <span class=\"token operator\">=</span> <span class=\"token function\">sub_19B50</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"libart.so\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0LL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> result <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">sub_19F78</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> a1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>调用 <code>fake-dlfcn</code>  解析获得 <code>libart.so</code>  中指定符号的地址，hook 即可得到参数 a1 为 <code>_ZN3art9ArtMethod12PrettyMethodEb</code> ，这里就可以解答之前的迷惑了，这里的 getSym 是 <code>Frida</code>  检测的一部分。</p>\n<figure class=\"highlight dart\"><figcaption data-lang=\"dart\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>bool isSpecialKey <span class=\"token operator\">=</span> symBuffer<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">0xD6</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// 6. 根据密钥类型选择不同的处理路径</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Uint8List</span> finalKeyBytes<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isSpecialKey<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token comment\">// 特殊密钥路径：使用 ivBytes2</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token keyword\">final</span> keyData <span class=\"token operator\">=</span> <span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>int<span class=\"token punctuation\">></span></span> keyList <span class=\"token operator\">=</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>int<span class=\"token punctuation\">></span></span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>keyData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      keyList<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>ivBytes2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      finalKeyBytes <span class=\"token operator\">=</span> <span class=\"token class-name\">Uint8List</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromList</span><span class=\"token punctuation\">(</span>keyList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token comment\">// 普通密钥路径：使用 ivBytes1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token keyword\">final</span> keyData <span class=\"token operator\">=</span> <span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>int<span class=\"token punctuation\">></span></span> keyList <span class=\"token operator\">=</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>int<span class=\"token punctuation\">></span></span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>keyData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      keyList<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>ivBytes1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      finalKeyBytes <span class=\"token operator\">=</span> <span class=\"token class-name\">Uint8List</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromList</span><span class=\"token punctuation\">(</span>keyList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    int checkByte <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>symData<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">>></span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token number\">0xD6</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 检查第 3 个字节的高位</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>checkByte <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token comment\">// 如果检查通过，退出应用</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token class-name\">SystemNavigator</span><span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>检测 <code>PrettyMethod</code>  的函数头是否有 <code>br</code>  指令特征（0xD6），<br />\n检测点来自代码 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZyaWRhL2ZyaWRhLWphdmEtYnJpZGdlL2Jsb2IvOWJmODZiNzE4YWIzZTlkNTBkOTMzM2RiYTFmMjZlOGY3YWFkODUyYi9saWIvYW5kcm9pZC5qcyNMNDgwOQ==\">frida-java-bridge</span>， <code>libmsaoaidsec.so</code>  也存在这种检测方案。</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>LOAD<span class=\"token operator\">:</span><span class=\"token number\">00000000001</span>A8BF4             <span class=\"token punctuation\">;</span> _QWORD art<span class=\"token operator\">::</span>ArtMethod<span class=\"token operator\">::</span><span class=\"token function\">PrettyMethod</span><span class=\"token punctuation\">(</span>art<span class=\"token operator\">::</span>ArtMethod <span class=\"token operator\">*</span>__hidden this<span class=\"token punctuation\">,</span> bool<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>LOAD<span class=\"token operator\">:</span><span class=\"token number\">00000000001</span>A8BF4                             EXPORT _ZN3art9ArtMethod12PrettyMethodEb</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>LOAD<span class=\"token operator\">:</span><span class=\"token number\">00000000001</span>A8BF4             _ZN3art9ArtMethod12PrettyMethodEb       <span class=\"token punctuation\">;</span> CODE XREF<span class=\"token operator\">:</span> sub_1549B8<span class=\"token operator\">+</span><span class=\"token number\">174</span>↑p</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>LOAD<span class=\"token operator\">:</span><span class=\"token number\">00000000001</span>A8BF4                                                     <span class=\"token punctuation\">;</span> sub_1698B8<span class=\"token operator\">+</span><span class=\"token number\">174</span>↑p <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>LOAD<span class=\"token operator\">:</span><span class=\"token number\">00000000001</span>A8BF4 <span class=\"token number\">50</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">58</span>                 LDR             X16<span class=\"token punctuation\">,</span> loc_1A8BFC</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>LOAD<span class=\"token operator\">:</span><span class=\"token number\">00000000001</span>A8BF8 <span class=\"token number\">00</span> <span class=\"token number\">02</span> <span class=\"token number\">1F</span> D6                 BR              X16</pre></td></tr></table></figure><p>这个检测点从代码上来看，但凡使用过 <code>frida-java-bridge</code>  的都会存在，但在我测试 <code>Frida 16</code>  最后一个版本时（16.7.19），这个检测点完全失效了。失效原因十分奇特，这个函数字节码在程序里的检测代码来看是完全正常的，但在我使用 Frida 把 <code>libart.so</code>  给 <code>dump</code>  出来时却发现该位置已经是被修改了。当我再切换到 <code>Frida 16.5.6</code>  检测代码成功检测到字节码被修改。只能猜到新版 <code>Frida</code>  应用了某些特殊修改，此检测机制对于新版 <code>Frida</code>  可能失效，有师傅能解答我的疑问的话，可以在评论留言。<br />\n题目中绕过这个检测的就能获得真正的 <code>aeskey</code> ，如果没绕过就会退出程序。</p>\n<p>接下来就是程序最重要的部分了，在 <code>.init_proc</code>  有如下代码</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">init_proc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  FILE <span class=\"token operator\">*</span>v0<span class=\"token punctuation\">;</span> <span class=\"token comment\">// x0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token class-name\">int8x16_t</span> v1<span class=\"token punctuation\">;</span> <span class=\"token comment\">// q1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  __int64 v2<span class=\"token punctuation\">;</span> <span class=\"token comment\">// x19</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  __int64 v3<span class=\"token punctuation\">;</span> <span class=\"token comment\">// x21</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  v34 <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token function\">_ReadStatusReg</span><span class=\"token punctuation\">(</span><span class=\"token function\">ARM64_SYSREG</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">13</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  v33 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>          <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>l<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>          <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10250<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  v0 <span class=\"token operator\">=</span> <span class=\"token function\">dlopen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v33<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>              <span class=\"token comment\">// libart.so</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  v1 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>l<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  v2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>__int64<span class=\"token punctuation\">)</span>v0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>s2 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10150<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  v26 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10270<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  v27 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10100<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  v28 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10180<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  v29 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_101D0<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  v30 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10130<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  v31 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10190<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  v32 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10260<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  v3 <span class=\"token operator\">=</span> <span class=\"token function\">dlsym</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>__int64<span class=\"token punctuation\">)</span>v0<span class=\"token punctuation\">,</span> s2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                  <span class=\"token comment\">// _ZN3art11interpreter6DoCallILb0EEEbPNS_9ArtMethodEPNS_6ThreadERNS_11ShadowFrameEPKNS_11InstructionEtbPNS_6JValueE</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span>v3 <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    v4 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>l<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>v17 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v4<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10150<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    v18 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v4<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10270<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    v19 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v4<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10120<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    v20 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v4<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_101E0<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    v21 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v4<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_101A0<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    v22 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v4<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10230<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    v23 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v4<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10200<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    v24 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v4<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_101B0<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    v3 <span class=\"token operator\">=</span> <span class=\"token function\">dlsym</span><span class=\"token punctuation\">(</span>v2<span class=\"token punctuation\">,</span> v17<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                        <span class=\"token comment\">// _ZN3art11interpreter6DoCallILb0ELb0EEEbPNS_9ArtMethodEPNS_6ThreadERNS_11ShadowFrameEPKNS_11InstructionEtPNS_6JValueE</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  v5 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>l<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>v17 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v5<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10110<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  v18 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v5<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10210<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  v19 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v5<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10160<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  off_41F40 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>_UNKNOWN <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">dlsym</span><span class=\"token punctuation\">(</span>v2<span class=\"token punctuation\">,</span> v17<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">// _ZN3art9ArtMethod12PrettyMethodEb</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  v6 <span class=\"token operator\">=</span> <span class=\"token function\">getpagesize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  v7 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">linux_eabi_syscall</span><span class=\"token punctuation\">(</span>__NR_mmap<span class=\"token punctuation\">,</span> <span class=\"token number\">0LL</span><span class=\"token punctuation\">,</span> v6<span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0LL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>v7<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> v6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>  <span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>v7<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>shellcode_end_ <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  jmp_addr_ <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>__int64<span class=\"token punctuation\">)</span>v7<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v7<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>the_func_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sub_1A51C<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v7<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>end_func_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sub_1A6E0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v7<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>retback_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v3 <span class=\"token operator\">+</span> <span class=\"token number\">16</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  v8 <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>ori_ins_set1_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_ <span class=\"token operator\">+</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v7<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>ori_ins_set1_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>v3<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v7<span class=\"token punctuation\">[</span>v8<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>v3 <span class=\"token operator\">+</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  v9 <span class=\"token operator\">=</span> <span class=\"token function\">linux_eabi_syscall</span><span class=\"token punctuation\">(</span>__NR_mprotect<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>__int64<span class=\"token punctuation\">)</span>v6 <span class=\"token operator\">&amp;</span> v3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> v6<span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>v3 <span class=\"token operator\">=</span> trampoline_<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>v3 <span class=\"token operator\">+</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> jmp_addr_<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  v10 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>l<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>  leave1 <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>shellcode_part2_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>v14 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v10<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_101C0<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  v15 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v10<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10140<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  v16 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v10<span class=\"token punctuation\">,</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10170<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>  v11 <span class=\"token operator\">=</span> <span class=\"token function\">dlsym</span><span class=\"token punctuation\">(</span>v2<span class=\"token punctuation\">,</span> v14<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                         <span class=\"token comment\">// _ZNK3art9OatHeader12IsDebuggableE</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>  v12 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">linux_eabi_syscall</span><span class=\"token punctuation\">(</span>__NR_mmap<span class=\"token punctuation\">,</span> <span class=\"token number\">0LL</span><span class=\"token punctuation\">,</span> v6<span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0LL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>  <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>v12<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> v6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>  <span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>v12<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>shellcode_end_ <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  jmp_addr_ <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>__int64<span class=\"token punctuation\">)</span>v12<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v12<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>the_func_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sub_1A710<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v12<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>end_func_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sub_1A76C<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v12<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>retback_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v11 <span class=\"token operator\">+</span> <span class=\"token number\">16</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v12<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>ori_ins_set1_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>v11<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v12<span class=\"token punctuation\">[</span>v8<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>v11 <span class=\"token operator\">+</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>  result <span class=\"token operator\">=</span> <span class=\"token function\">linux_eabi_syscall</span><span class=\"token punctuation\">(</span>__NR_mprotect<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>v11 <span class=\"token operator\">&amp;</span> <span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>__int64<span class=\"token punctuation\">)</span>v6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> v6<span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>v11 <span class=\"token operator\">=</span> trampoline_<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>v11 <span class=\"token operator\">+</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> jmp_addr_<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  leave2 <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>shellcode_part2_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>  <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>有字符串混淆，代码使用 <code>neon指令集</code> 对字符串进行解密， <code>veorq_s8</code>  和 <code>vqtbl1q_s8</code> ，一个是异或指令，一个是取表换位指令，了解一下就可以写出字符串解密脚本，用 <code>Frida</code>   <code>hook init</code>  需要 <code>Hook连接器</code> 也可以恢复出来。</p>\n<p>接下来分析函数，首先是 <code>shellcode</code>  全局变量，转化为汇编后可以看到保护现场的 <code>shellcode</code></p>\n<pre><code>\n.data:0000000000041C88\n.data:0000000000041C88                 MOV             X1, X30\n.data:0000000000041C8C                 STP             X1, X0, [SP,#arg_40]\n.data:0000000000041C90                 STP             XZR, X2, [SP,#arg_50]\n.data:0000000000041C94                 MOV             X30, X2\n.data:0000000000041C98                 LDP             X1, X0, [SP,#arg_30]\n.data:0000000000041C9C                 LDP             X3, X2, [SP,#arg_20]\n.data:0000000000041CA0                 SUB             SP, SP, #0x200\n.data:0000000000041CA4                 STP             Q0, Q1, [SP,#0x200+var_200]\n.data:0000000000041CA8                 STP             Q2, Q3, [SP,#0x200+var_1E0]\n.data:0000000000041CAC                 STP             Q4, Q5, [SP,#0x200+var_1C0]\n.data:0000000000041CB0                 STP             Q6, Q7, [SP,#0x200+var_1A0]\n.data:0000000000041CB4                 STP             X0, X1, [SP,#0x200+var_200]\n.data:0000000000041CB8                 STP             X2, X3, [SP,#0x200+var_1F0]\n.data:0000000000041CBC                 STP             X4, X5, [SP,#0x200+var_1E0]\n.data:0000000000041CC0                 STP             X6, X7, [SP,#0x200+var_1D0]\n.data:0000000000041CC4                 STP             X8, X9, [SP,#0x200+var_1C0]\n.data:0000000000041CC8                 STP             X10, X11, [SP,#0x200+var_1B0]\n.data:0000000000041CCC                 STP             X12, X13, [SP,#0x200+var_1A0]\n.data:0000000000041CD0                 STP             X14, X15, [SP,#0x200+var_190]\n.data:0000000000041CD4                 STP             X16, X17, [SP,#0x200+var_180]\n.data:0000000000041CD8                 STP             X18, X19, [SP,#0x200+var_170]\n.data:0000000000041CDC                 STP             X20, X21, [SP,#0x200+var_160]\n.data:0000000000041CE0                 STP             X22, X23, [SP,#0x200+var_150]\n.data:0000000000041CE4                 STP             X24, X25, [SP,#0x200+var_140]\n.data:0000000000041CE8                 STP             X26, X27, [SP,#0x200+var_130]\n.data:0000000000041CEC                 STP             X28, X29, [SP,#0x200+var_120]\n.data:0000000000041CF0                 STP             X30, XZR, [SP,#0x200+var_110]\n.data:0000000000041CF4                 ADD             X0, SP, #0x200+arg_0\n.data:0000000000041CF8                 ADR             X16, _the_func_addr_\n.data:0000000000041CFC                 LDR             X16, [X16]\n.data:0000000000041D00                 BLR             X16\n.data:0000000000041D04                 LDP             X0, X1, [SP,#0x200+var_200]\n.data:0000000000041D08                 LDP             X2, X3, [SP,#0x200+var_1F0]\n.data:0000000000041D0C                 LDP             X4, X5, [SP,#0x200+var_1E0]\n.data:0000000000041D10                 LDP             X6, X7, [SP,#0x200+var_1D0]\n.data:0000000000041D14                 LDP             X8, X9, [SP,#0x200+var_1C0]\n.data:0000000000041D18                 LDP             X10, X11, [SP,#0x200+var_1B0]\n.data:0000000000041D1C                 LDP             X12, X13, [SP,#0x200+var_1A0]\n.data:0000000000041D20                 LDP             X14, X15, [SP,#0x200+var_190]\n.data:0000000000041D24                 LDP             X16, X17, [SP,#0x200+var_180]\n.data:0000000000041D28                 LDP             X18, X19, [SP,#0x200+var_170]\n.data:0000000000041D2C                 LDP             X20, X21, [SP,#0x200+var_160]\n.data:0000000000041D30                 LDP             X22, X23, [SP,#0x200+var_150]\n.data:0000000000041D34                 LDP             X24, X25, [SP,#0x200+var_140]\n.data:0000000000041D38                 LDP             X26, X27, [SP,#0x200+var_130]\n.data:0000000000041D3C                 LDP             X28, X29, [SP,#0x200+var_120]\n.data:0000000000041D40                 LDP             X30, XZR, [SP,#0x200+var_110]\n.data:0000000000041D44                 LDP             Q0, Q1, [SP,#0x200+var_200]\n.data:0000000000041D48                 LDP             Q2, Q3, [SP,#0x200+var_1E0]\n.data:0000000000041D4C                 LDP             Q4, Q5, [SP,#0x200+var_1C0]\n.data:0000000000041D50                 LDP             Q6, Q7, [SP,#0x200+var_1A0]\n.data:0000000000041D54                 ADD             SP, SP, #0x200\n.data:0000000000041D58                 LDP             X7, X6, [SP,#arg_0]\n.data:0000000000041D5C                 LDP             X5, X4, [SP,#arg_10]\n.data:0000000000041D60                 LDP             X3, X2, [SP,#arg_20]\n.data:0000000000041D64                 LDP             X1, X0, [SP,#arg_30]\n.data:0000000000041D68                 LDP             XZR, X30, [SP,#arg_50]\n.data:0000000000041D6C                 ADD             SP, SP, #0x60 ; '`'\n.data:0000000000041D70\n.data:0000000000041D70                 EXPORT _ori_ins_set1_\n</code></pre>\n<p>有保护现场的 <code>shellcode</code> ，有 <code>jmp_addr_</code> 全局变量，还有以下把函数赋值到变量的操作，可以想到是 <code>inlinehook</code>  了</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jmp_addr_ <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>__int64<span class=\"token punctuation\">)</span>v7<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v7<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>the_func_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sub_1A51C<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v7<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>end_func_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sub_1A6E0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v7<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>retback_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v3 <span class=\"token operator\">+</span> <span class=\"token number\">16</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  v8 <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>ori_ins_set1_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_ <span class=\"token operator\">+</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>Hook 的目标肯定是那些 C 艹符号，可以梳理一下流程：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dl <span class=\"token operator\">=</span> <span class=\"token function\">fk_dlopen</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"libart.so\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>docall_sym <span class=\"token operator\">=</span> <span class=\"token function\">fk_dlsym</span><span class=\"token punctuation\">(</span>dl<span class=\"token punctuation\">,</span><span class=\"token string\">\"...DoCall...\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>docall_sym <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  docall_sym <span class=\"token operator\">=</span> <span class=\"token function\">fk_dlsym</span><span class=\"token punctuation\">(</span>dl<span class=\"token punctuation\">,</span><span class=\"token string\">\"...DoCall2...\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>prettymethod_sym <span class=\"token operator\">=</span> <span class=\"token function\">fk_dlsym</span><span class=\"token punctuation\">(</span>dl<span class=\"token punctuation\">,</span><span class=\"token string\">\"...PrettyMethod...\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">hook</span><span class=\"token punctuation\">(</span>docall_sym<span class=\"token punctuation\">,</span>enter_fun<span class=\"token punctuation\">,</span>leave_fun<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>IsDebuggable_sym <span class=\"token operator\">=</span> <span class=\"token function\">fk_dlsym</span><span class=\"token punctuation\">(</span>dl<span class=\"token punctuation\">,</span><span class=\"token string\">\"...IsDebuggable...\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">hook</span><span class=\"token punctuation\">(</span>IsDebuggable_sym<span class=\"token punctuation\">,</span>enter_fun2<span class=\"token punctuation\">,</span>leave_fun2<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>对于  <code>IsDebuggable</code></p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v12<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>the_func_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sub_1A710<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v12<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>end_func_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sub_1A76C<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>看 <code>shellcode</code>  可以知道第一个是 <code>onEnter</code> ，第二个是 <code>onLeave</code> ，这两个函数并没有太多更改操作，仅 <code>sub_1A710</code>  更改函数返回指为 1。为什么要 Hook 这个函数？这里是为了杜绝代码走 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zb3VyY2UuYW5kcm9pZC5nb29nbGUuY24vZG9jcy9jb3JlL3J1bnRpbWUvaml0LWNvbXBpbGVyP2hsPXpoLWNu\">JIT</span> ，大家都知道，安卓字节码最终执行有三种路径：解释模式， <code>JIT</code> ，和 <code>AOT</code> <br />\n<img data-src=\"https://source.android.google.cn/docs/core/runtime/images/jit-arch.png?hl=zh-cn\" alt=\"JIT\" /><br />\n 解释模式顾名思义就是 <code>VM</code>  解析字节码然后运行（本题目需要走这种模式）， <code>JIT</code>  就是运行时编译成机械码， <code>AOT</code>  就是运行前编译成机械码。后两种编译模式共用一个编译器。本次的 <code>Apk</code>  是 <code>Release</code>  构建的默认会使 <code>Java</code>  代码的执行走 <code>AOT</code> （ <code>AOT</code>  文件会在 <code>Apk</code>  安装时生成，同时在 <code>Apk</code>  运行时通过收集信息优化 <code>oat</code>  文件），如果不进行处理，后面的 <code>DoCall</code>  是不会被触发的（因为 <code>DoCall</code>  是解释模式才会用到的，这一点从 <code>art::interpreter::DoCall</code>  这个前缀就可以看出来），值得注意的是如果你将 <code>Apk</code>  编译为 <code>Debug</code>  将不会触发 <code>AOT</code> ，但或许会触发 <code>JIT</code> ，权衡下还是以 <code>Release</code>  为目标了，也是为了学习吧哈哈。</p>\n<p>当初立马想到， <code>DEX</code>  如果是在 <code>apk</code>  安装才会指出 <code>dex2oat</code>  那为什么不直接通过动态加载 <code>Dex</code>  绕过 <code>AOT</code>  呢，我马上加载马上使用的 <code>Dex</code>  你总不可能优化了吧。但这个思路是不可行的，动态加载 <code>Dex</code>  不走 <code>oat</code>  只有一种情况：使用 <code>InMemoryDexClassLoader</code> ，但从 <code>Android10</code>  开始， <code>InMemoryDexClassLoader</code>  加载的 <code>Dex</code>  文件也会走 <code>AOT</code>  流程。那么剩下的方法就是  <code>Hook</code>  AOT 加载流程，需要找一个必定导出 <code>libart.so</code>  函数来实施计划，打开 AOSP 看看，但随即发现大部分符号都是 <code>HIDDEN</code>  的，能使用的符号少之又少，又由于题目的 <code>hook</code>  程序是在点击后启动的，几乎很难找到符合要求的 <code>Hook</code>  点。随后在拷打 ai 的时候发现 <code>_ZNK3art9OatHeader12IsDebuggableE</code> ，尝试后发现能在 <code>Release</code>  打包使 <code>DoCall</code>  被 <code>Hook</code>  到，在 <code>a11～a15</code>  的设备测试也没有问题，由于 ddl 临近没深追究就用上了。</p>\n<p>对于 <code>DoCall</code></p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v7<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>the_func_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sub_1A51C<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>v7<span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span>end_func_addr_ <span class=\"token operator\">-</span> <span class=\"token operator\">&amp;</span>shellcode_start_<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sub_1A6E0<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>只分析 <code>sub_1A51C</code>  即可</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> __fastcall <span class=\"token function\">sub_1A51C</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span>a1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  __int64 v2<span class=\"token punctuation\">;</span> <span class=\"token comment\">// x21</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  __int64 v3<span class=\"token punctuation\">;</span> <span class=\"token comment\">// x21</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token class-name\">int8x16_t</span> v4<span class=\"token punctuation\">;</span> <span class=\"token comment\">// q0</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token class-name\">int8x16_t</span> v5<span class=\"token punctuation\">;</span> <span class=\"token comment\">// q3</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token class-name\">int8x16_t</span> v6<span class=\"token punctuation\">;</span> <span class=\"token comment\">// q1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>v7<span class=\"token punctuation\">;</span> <span class=\"token comment\">// x19</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token class-name\">size_t</span> v8<span class=\"token punctuation\">;</span> <span class=\"token comment\">// x1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  __int64 i<span class=\"token punctuation\">;</span> <span class=\"token comment\">// x9</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  __int16 v10<span class=\"token punctuation\">;</span> <span class=\"token comment\">// w8</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token keyword\">int</span> v11<span class=\"token punctuation\">;</span> <span class=\"token comment\">// w0</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  __int16 v12<span class=\"token punctuation\">;</span> <span class=\"token comment\">// w13</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  __int128 v13<span class=\"token punctuation\">;</span> <span class=\"token comment\">// q1</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  _OWORD <span class=\"token operator\">*</span>v14<span class=\"token punctuation\">;</span> <span class=\"token comment\">// x8</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  __int128 v15<span class=\"token punctuation\">;</span> <span class=\"token comment\">// q0</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  __int128 v16<span class=\"token punctuation\">;</span> <span class=\"token comment\">// q2</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  __int128 v17<span class=\"token punctuation\">;</span> <span class=\"token comment\">// q3</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  __int128 v18<span class=\"token punctuation\">;</span> <span class=\"token comment\">// q0</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  __int128 v19<span class=\"token punctuation\">;</span> <span class=\"token comment\">// q2</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  __int128 v20<span class=\"token punctuation\">;</span> <span class=\"token comment\">// q3</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>v21<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [xsp+8h] [xbp-48h] BYREF</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>v22<span class=\"token punctuation\">;</span> <span class=\"token comment\">// [xsp+18h] [xbp-38h]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token keyword\">char</span> needle<span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [xsp+20h] [xbp-30h] BYREF</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token keyword\">char</span> v24<span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [xsp+30h] [xbp-20h] BYREF</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  __int64 v25<span class=\"token punctuation\">;</span> <span class=\"token comment\">// [xsp+48h] [xbp-8h]</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  v25 <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token function\">_ReadStatusReg</span><span class=\"token punctuation\">(</span><span class=\"token function\">ARM64_SYSREG</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">13</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  v2 <span class=\"token operator\">=</span> a1<span class=\"token punctuation\">[</span><span class=\"token number\">11</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_QWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">__emutls_get_address</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>_emutls_v_ori_lr1<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> v2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  v3 <span class=\"token operator\">=</span> a1<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token function\">prettymethod_sym</span><span class=\"token punctuation\">(</span>v21<span class=\"token punctuation\">,</span> a1<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0LL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  v4 <span class=\"token operator\">=</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_101F0<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  v5 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>l<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  v6 <span class=\"token operator\">=</span> <span class=\"token function\">vqtbl1q_s8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>xmmword_10240<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span><span class=\"token punctuation\">)</span>shellcode_end_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>__int64<span class=\"token punctuation\">)</span>v21<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    v7 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>v22<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    v7 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>v21 <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>needle <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v5<span class=\"token punctuation\">,</span> v4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int8x16_t</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>v24 <span class=\"token operator\">=</span> <span class=\"token function\">veorq_s8</span><span class=\"token punctuation\">(</span>v5<span class=\"token punctuation\">,</span> v6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> v7 <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">strstr</span><span class=\"token punctuation\">(</span>v7<span class=\"token punctuation\">,</span> needle<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span>                   <span class=\"token comment\">// gic.toB</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      qword_41F58 <span class=\"token operator\">=</span> v3<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      v8 <span class=\"token operator\">=</span> <span class=\"token function\">getpagesize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0LL</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">!=</span> <span class=\"token number\">160</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">2LL</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        v11 <span class=\"token operator\">=</span> <span class=\"token function\">linux_eabi_syscall</span><span class=\"token punctuation\">(</span>__NR_mprotect<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>__int64<span class=\"token punctuation\">)</span>v8 <span class=\"token operator\">&amp;</span> v3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> v8<span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        v12 <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_WORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>v3 <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_WORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>xmmword_41F60 <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> v12<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> __int8<span class=\"token punctuation\">)</span>v12 <span class=\"token operator\">==</span> <span class=\"token number\">179</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>          v10 <span class=\"token operator\">=</span> v12 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFFB2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>          v10 <span class=\"token operator\">=</span> v12<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> __int8<span class=\"token punctuation\">)</span>v12 <span class=\"token operator\">==</span> <span class=\"token number\">179</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> __int8<span class=\"token punctuation\">)</span>v10 <span class=\"token operator\">==</span> <span class=\"token number\">224</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> __int8<span class=\"token punctuation\">)</span>v10 <span class=\"token operator\">==</span> <span class=\"token number\">224</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            v10 <span class=\"token operator\">|=</span> <span class=\"token number\">2u</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>          <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_WORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>v3 <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> v10<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">strstr</span><span class=\"token punctuation\">(</span>v7<span class=\"token punctuation\">,</span> v24<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span>                 <span class=\"token comment\">// gic.fi</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>      v13 <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_OWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>algn_41F70<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>      v14 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>_OWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>qword_41F58<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>      <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_OWORD <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>qword_41F58 <span class=\"token operator\">=</span> xmmword_41F60<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>      v14<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v13<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>      v15 <span class=\"token operator\">=</span> unk_41FB0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>      v17 <span class=\"token operator\">=</span> xmmword_41F80<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>      v16 <span class=\"token operator\">=</span> unk_41F90<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>      v14<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> xmmword_41FA0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>      v14<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v15<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>      v14<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v17<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>      v14<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v16<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>      v18 <span class=\"token operator\">=</span> unk_41FF0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>      v20 <span class=\"token operator\">=</span> xmmword_41FC0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>      v19 <span class=\"token operator\">=</span> unk_41FD0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>      v14<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> xmmword_41FE0<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>      v14<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v18<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>      v14<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v20<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>      v14<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v19<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>解密字符串可以得到 <code>gic.toB</code>  和 <code>gic.fi</code> ，对应 <code>magic.fixKey</code>  和 <code>magic.toByteArray</code> ，结合 C 艹函数 <code>DoCall</code> ，可以猜测，Java 层代码在执行时，会被这个 <code>onEnter</code>  进行某种处理。<br />\n根据符号可以定位到这个函数 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jcy5hbmRyb2lkLmNvbS9hbmRyb2lkL3BsYXRmb3JtL3N1cGVycHJvamVjdC9tYWluLysvbWFpbjphcnQvcnVudGltZS9pbnRlcnByZXRlci9pbnRlcnByZXRlcl9jb21tb24uY2M7ZHJjPTYxMTk3MzY0MzY3YzllNDA0YzdkYTY5MDA2NThmMWIxNmM0MmQwZGE7bD0xMzU2P3E9SW50ZXJwcmV0ZXJfY29tbW8mYW1wO3NzPWFuZHJvaWQlMkZwbGF0Zm9ybSUyRnN1cGVycHJvamVjdCUyRm1haW4mYW1wO2hsPXpoLWNu\">Aosp DoCall</span><br />\n 以下解释来自 <code>Deepseek</code></p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 执行方法调用 - ART 解释器核心方法调用例程</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * 处理所有 invoke-XXX 指令的实际调用分派</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * </pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @param called_method  目标方法对象指针，已解析好的要调用的方法</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @param self          当前线程对象指针</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * @param shadow_frame  当前栈帧引用，包含局部变量和操作数栈</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @param inst          当前指令指针，指向正在执行的 invoke 指令</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @param inst_data     指令数据，已解码的指令操作数</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @param is_string_init 是否为字符串构造函数特殊处理</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @param result        方法返回值存储位置</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @return bool         调用是否成功执行</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>bool <span class=\"token function\">DoCall</span><span class=\"token punctuation\">(</span>ArtMethod<span class=\"token operator\">*</span> called_method<span class=\"token punctuation\">,</span>    <span class=\"token comment\">// 目标方法</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            Thread<span class=\"token operator\">*</span> self<span class=\"token punctuation\">,</span>                <span class=\"token comment\">// 当前线程  </span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            ShadowFrame<span class=\"token operator\">&amp;</span> shadow_frame<span class=\"token punctuation\">,</span>   <span class=\"token comment\">// 当前栈帧</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">const</span> Instruction<span class=\"token operator\">*</span> inst<span class=\"token punctuation\">,</span>     <span class=\"token comment\">// 调用指令</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">uint16_t</span> inst_data<span class=\"token punctuation\">,</span>          <span class=\"token comment\">// 指令数据</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            bool is_string_init<span class=\"token punctuation\">,</span>         <span class=\"token comment\">// 字符串构造标记</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            JValue<span class=\"token operator\">*</span> result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>            <span class=\"token comment\">// 返回值存储</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">// 从指令中获取参数个数（区分 range 和非 range 格式）</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token keyword\">const</span> <span class=\"token class-name\">uint16_t</span> number_of_inputs <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">(</span>is_range<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> inst<span class=\"token operator\">-></span><span class=\"token function\">VRegA_3rc</span><span class=\"token punctuation\">(</span>inst_data<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> inst<span class=\"token operator\">-></span><span class=\"token function\">VRegA_35c</span><span class=\"token punctuation\">(</span>inst_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token comment\">// 参数寄存器处理：非 range 使用数组，range 使用连续寄存器段</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token class-name\">uint32_t</span> arg<span class=\"token punctuation\">[</span>Instruction<span class=\"token operator\">::</span>kMaxVarArgRegs<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token class-name\">uint32_t</span> vregC <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>is_range<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    vregC <span class=\"token operator\">=</span> inst<span class=\"token operator\">-></span><span class=\"token function\">VRegC_3rc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//range 格式：起始寄存器编号</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    vregC <span class=\"token operator\">=</span> inst<span class=\"token operator\">-></span><span class=\"token function\">VRegC_35c</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 非 range 格式：参数寄存器数组</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    inst<span class=\"token operator\">-></span><span class=\"token function\">GetVarArgs</span><span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">,</span> inst_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token comment\">// 调用通用处理逻辑</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token keyword\">return</span> DoCallCommon<span class=\"token operator\">&lt;</span>is_range<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>called_method<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">,</span> shadow_frame<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                               number_of_inputs<span class=\"token punctuation\">,</span> arg<span class=\"token punctuation\">,</span> vregC<span class=\"token punctuation\">,</span> is_string_init<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>这里面有两个参数很重要，一个是 <code>called_method</code> ，一个是 <code>inst</code> 。<br />\n <code>called_method</code>  包含被调用者所有信息， <code>AOSP</code>  有如下代码，通过 之前获得的 <code>prettymethod_sym</code>  可以直接获得被调函数的函数名</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>std<span class=\"token operator\">::</span>string ArtMethod<span class=\"token operator\">::</span><span class=\"token function\">PrettyMethod</span><span class=\"token punctuation\">(</span>ArtMethod<span class=\"token operator\">*</span> m<span class=\"token punctuation\">,</span> bool with_signature<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>m <span class=\"token operator\">==</span> nullptr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"null\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">return</span> m<span class=\"token operator\">-></span><span class=\"token function\">PrettyMethod</span><span class=\"token punctuation\">(</span>with_signature<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>而 <code>inst</code>  就有用了， <code>class Instruction</code>  是一个专门用于解释模式字节码解析的一个类 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jcy5hbmRyb2lkLmNvbS9hbmRyb2lkL3BsYXRmb3JtL3N1cGVycHJvamVjdC9tYWluLysvbWFpbjphcnQvbGliZGV4ZmlsZS9kZXgvZGV4X2luc3RydWN0aW9uLmg7bD0xODtkcmM9NjExOTczNjQzNjdjOWU0MDRjN2RhNjkwMDY1OGYxYjE2YzQyZDBkYT9xPWRleF9pbnN0cnVjdGlvbi5oJmFtcDtzcz1hbmRyb2lkJTJGcGxhdGZvcm0lMkZzdXBlcnByb2plY3QlMkZtYWluJmFtcDtobD16aC1jbg==\">Instruction Aosp</span></p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">const</span> Instruction<span class=\"token operator\">*</span> <span class=\"token function\">At</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token class-name\">uint16_t</span><span class=\"token operator\">*</span> code<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token function\">DCHECK</span><span class=\"token punctuation\">(</span>code <span class=\"token operator\">!=</span> nullptr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">return</span> reinterpret_cast<span class=\"token operator\">&lt;</span><span class=\"token keyword\">const</span> Instruction<span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\">// Reads an instruction out of the stream from the current address plus an offset.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">const</span> Instruction<span class=\"token operator\">*</span> <span class=\"token function\">RelativeAt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">int32_t</span> offset<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> WARN_UNUSED <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">At</span><span class=\"token punctuation\">(</span>reinterpret_cast<span class=\"token operator\">&lt;</span><span class=\"token keyword\">const</span> <span class=\"token class-name\">uint16_t</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>this<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> offset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token comment\">// Returns a pointer to the next instruction in the stream.</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token keyword\">const</span> Instruction<span class=\"token operator\">*</span> <span class=\"token function\">Next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">RelativeAt</span><span class=\"token punctuation\">(</span><span class=\"token function\">SizeInCodeUnits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>看到这些代码就可以秒懂了，只要把内存中函数的字节码转为 <code>Instruction*</code> ，就可以利用其中函数读取操作码和操作数。那么通过 <code>inst</code>  拿到的指针就是 <code>Dex</code>  的指针，只要把指针向前回溯到 <code>Dex</code>  头就可以操作正在运行的整个 <code>Dex</code>  文件。<br />\n <code>ddl</code>  近在眼前，没时间写什么华丽的修改代码的，使用了最简单的修改方式，题目是设置一个比对器，通过比对正在执行的 <code>Java</code>  函数名来修改字节码。当执行到 <code>call magic.fixKey</code>  就将该字节码下方的逻辑修改掉，直到被修改的逻辑执行完毕运行到 <code>call magic.toByteArray</code>  再把改掉的字节码改回来。</p>\n<p>这里解释一下为什么我选 <code>DoCall</code>  但是没有选 <code>ArtMethod::Invoke</code> ， <code>Invoke</code>  函数头如下</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> ArtMethod<span class=\"token operator\">::</span><span class=\"token function\">Invoke</span><span class=\"token punctuation\">(</span>Thread<span class=\"token operator\">*</span> self<span class=\"token punctuation\">,</span> <span class=\"token class-name\">uint32_t</span><span class=\"token operator\">*</span> args<span class=\"token punctuation\">,</span> <span class=\"token class-name\">uint32_t</span> args_size<span class=\"token punctuation\">,</span> JValue<span class=\"token operator\">*</span> result<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> shorty<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>这个函数是在函数 <code>DoCall</code>  的下层执行，可以通过 <code>this</code>  拿到 <code>ArtMethod</code>  再进一步解析 <code>ArtMethod</code>  拿到 <code>GetCodeItem()</code>  在解析 <code>codeitem</code>  结构拿到 <code>Instruction</code> ，这个字节码获取流程太过复杂，对于 <code>Hook</code>  来说如果某些偏移是硬编码，那是很难适配多个版本安卓的。</p>\n<p>用什么改的已经知道了，那到底是怎么改的呢？<br />\n参照这个表格 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jcy5hbmRyb2lkLmNvbS9hbmRyb2lkL3BsYXRmb3JtL3N1cGVycHJvamVjdC9tYWluLysvbWFpbjphcnQvbGliZGV4ZmlsZS9kZXgvZGV4X2luc3RydWN0aW9uX2xpc3QuaDtsPTE4O2RyYz02MTE5NzM2NDM2N2M5ZTQwNGM3ZGE2OTAwNjU4ZjFiMTZjNDJkMGRhP3E9ZGV4X2luc3RydWN0aW9uX2xpc3QuaCZhbXA7c3E9JmFtcDtobD16aC1jbg==\">dex_instruction_list Aosp</span></p>\n<p><code>hex(179)-&gt;0xd3</code> <br />\n <code>hex(224)-&gt;0xe0</code></p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">V</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xB2</span><span class=\"token punctuation\">,</span> MUL_INT_2ADDR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"mul-int/2addr\"</span><span class=\"token punctuation\">,</span> k12x<span class=\"token punctuation\">,</span> kIndexNone<span class=\"token punctuation\">,</span> kContinue<span class=\"token punctuation\">,</span> kMultiply<span class=\"token punctuation\">,</span> kVerifyRegA <span class=\"token operator\">|</span> kVerifyRegB<span class=\"token punctuation\">)</span> \\</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token function\">V</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xB3</span><span class=\"token punctuation\">,</span> DIV_INT_2ADDR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"div-int/2addr\"</span><span class=\"token punctuation\">,</span> k12x<span class=\"token punctuation\">,</span> kIndexNone<span class=\"token punctuation\">,</span> kContinue <span class=\"token operator\">|</span> kThrow<span class=\"token punctuation\">,</span> kDivide<span class=\"token punctuation\">,</span> kVerifyRegA <span class=\"token operator\">|</span> kVerifyRegB<span class=\"token punctuation\">)</span> \\</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token function\">V</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xE0</span><span class=\"token punctuation\">,</span> SHL_INT_LIT8<span class=\"token punctuation\">,</span> <span class=\"token string\">\"shl-int/lit8\"</span><span class=\"token punctuation\">,</span> k22b<span class=\"token punctuation\">,</span> kIndexNone<span class=\"token punctuation\">,</span> kContinue<span class=\"token punctuation\">,</span> kShl <span class=\"token operator\">|</span> kRegCFieldOrConstant<span class=\"token punctuation\">,</span> kVerifyRegA <span class=\"token operator\">|</span> kVerifyRegB<span class=\"token punctuation\">)</span> \\</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token function\">V</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xE1</span><span class=\"token punctuation\">,</span> SHR_INT_LIT8<span class=\"token punctuation\">,</span> <span class=\"token string\">\"shr-int/lit8\"</span><span class=\"token punctuation\">,</span> k22b<span class=\"token punctuation\">,</span> kIndexNone<span class=\"token punctuation\">,</span> kContinue<span class=\"token punctuation\">,</span> kShr <span class=\"token operator\">|</span> kRegCFieldOrConstant<span class=\"token punctuation\">,</span> kVerifyRegA <span class=\"token operator\">|</span> kVerifyRegB<span class=\"token punctuation\">)</span> \\<span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token function\">V</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xE2</span><span class=\"token punctuation\">,</span> USHR_INT_LIT8<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ushr-int/lit8\"</span><span class=\"token punctuation\">,</span> k22b<span class=\"token punctuation\">,</span> kIndexNone<span class=\"token punctuation\">,</span> kContinue<span class=\"token punctuation\">,</span> kUshr <span class=\"token operator\">|</span> kRegCFieldOrConstant<span class=\"token punctuation\">,</span> kVerifyRegA <span class=\"token operator\">|</span> kVerifyRegB<span class=\"token punctuation\">)</span> \\</pre></td></tr></table></figure><p>改变乘除，改变移位方向。<br />\n也就是 <code>Java</code>  层的 <code>XXTEA</code>  已经完全被魔改了。<br />\n对于此处的节法，我预计的正解是 <code>Hook</code>  程序在 <code>magic.toByteArray</code>  触发前，在 <code>Java</code>  层使用 <code>Frida-dexdump</code>  获得魔改后的字符串，或者说把第二次 <code>strstr</code>  后的还原逻辑 <code>NOP</code>  掉，在出题后我也尝试过，此法可行， <code>dump</code>  出的 <code>Dex</code>  带有已修改的字节码，并且可以用 <code>Jeb</code>  反编译为 <code>Java</code>  代码。当然还可以使用 <code>Smali Trace</code>  来打印 <code>Smali</code>  执行流程，对比即可知道修改流程。比赛中的唯一解使用的是 CE 断点然后 <code>DUMP</code>  内存获得修改后的 <code>Dex</code> ，赛后也有师傅通过手修字节码来获得魔改后的逻辑的，都太强了 <code>QAQ</code> 。<br />\n魔改后的 <code>Java</code>  代码直接贴师傅们的图了。<br />\n<img data-src=\"image-4.png\" alt=\"alt text\" /><br />\n <code>Flutter</code>  加密完的 <code>AES</code>  密文会被 <code>send</code>  到 <code>Java</code>  进行魔改 XXTEA，最后得到加密结果比对验证，至此全部程序都结束了。</p>\n",
            "tags": [
                "Android",
                "汇编",
                "Re"
            ]
        },
        {
            "id": "https://pangbai.work/IT/kali/",
            "url": "https://pangbai.work/IT/kali/",
            "title": "干货！安卓手机上kali",
            "date_published": "2021-07-18T02:24:58.000Z",
            "content_html": "<h3 id=\"在你的任意安卓手机上刷入kali\"><a class=\"anchor\" href=\"#在你的任意安卓手机上刷入kali\">#</a>  <code>在你的任意安卓手机上刷入kali</code></h3>\n<p>在手机上稳定便捷运行 linux</p>\n<span id=\"more\"></span>\n<p>如果你了解过网络安全方面的知识，那你一定会听过 <code>Kali Linux </code> 的名字</p>\n<p>它被广泛使用于网络攻击，不过分的说，多年来，进攻安全系统一直以 Kali Linux 的系统主导市场。<br />\n而 <code>Kali Linux NetHunter</code>  则是一款适用于 Android 移动设备的 Kali Linux 渗透测试系统。(但从攻击工具的使用上，ANDRAX 似乎比已经过时的它更加好用)</p>\n<p>我是一个高中生，没有什么很厉害等想法，也没有想过黑客之类的东西，只想用手机玩玩 linux，看着指令行，用着电脑的图形页面很惬意。手机已经 root 自然不用去搞 termux 了，我把目光转向 chroot。于是安装了 <code>linuxdeploy</code> ，它可以选择不同的 linux 发行版与架构，非常完美，但我不认为它足够稳定。使用目录安装基本只会失败，而使用镜像更加鸡肋。经常挂载失败无法启动镜像，不是实体文件夹，难已备份数据，vnc 启动易死，只要有些东西错误，只能前功尽弃，然后重新安装 linux，又等个一个小时把之前的重新做一遍。</p>\n<p>于是，我想到了直接在手机上刷入 linux 的想法，然后发现了 nethunter，起初以为我的手机不支持这东西 (名单里似乎只有一加和谷歌的亲儿子)，逛了几个博客发现，有个通刷包，只是不能使用外接监听网卡。很激动，花了很时间线，最后成功了。</p>\n<h1 id=\"在手机上刷入kali\"><a class=\"anchor\" href=\"#在手机上刷入kali\">#</a> 在手机上刷入 kali</h1>\n<p>接下来进入主题，如何在安卓手机上刷人 Kali Linux NetHunter</p>\n<p><code>注: 本篇文章，只用于技术交流，旨在方便chroot运行linux，任何使用工具照成的后果与本人无关</code></p>\n<p>作者:  <code>PangBai</code> <br />\n <code>转载请注明来源</code></p>\n<p>准备条件</p>\n<ul>\n<li>一台已 root 的手机 (带 twrp 就不用说了)</li>\n<li>nethunter 通刷包</li>\n<li>一定的刷机经验</li>\n<li>备份数据和救砖准备 (其实失败几率很小)</li>\n</ul>\n<h2 id=\"下载kali-nethunter\"><a class=\"anchor\" href=\"#下载kali-nethunter\">#</a> 下载 kali nethunter</h2>\n<p>这里给出三个刷机包，请根据需要选择<br />\n arm 64 位最新版<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pbWFnZXMua2FsaS5vcmcvbmV0aHVudGVyL25ldGh1bnRlci0yMDIxLjItZ2VuZXJpYy1hcm02NC1rYWxpZnMtZnVsbC56aXA=\"> ARM64</span><br />\narm 32 位最新版<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pbWFnZXMua2FsaS5vcmcvbmV0aHVudGVyL25ldGh1bnRlci0yMDIxLjItZ2VuZXJpYy1hcm1oZi1rYWxpZnMtZnVsbC56aXA=\"> ARM32</span><br />\narm 32 位旧版<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9idWlsZC5uZXRodW50ZXIuY29tL2luc3RhbGxlci9nZW5lcmljL3VwZGF0ZS1uZXRodW50ZXItZ2VuZXJpYy1hcm1oZi0yMDE3MTAwN18yMTUxNDYuemlw\"> ARM32</span><br />\n 如果你仅仅想安装一个 linux 请选最后一个链接，包很小，但很多组件是旧的 (upgrade 直接几个 G 给你吃了，还耗了几个小时)</p>\n<h2 id=\"安装kali-nethunter\"><a class=\"anchor\" href=\"#安装kali-nethunter\">#</a> 安装 kali nethunter</h2>\n<p>手机关机，再按开机键和音量键，进入 TWRP<br />\n<img data-src=\"http://shp.qpic.cn/collector/1642981619/678ec442-bfd7-4ef7-bd6c-13beb8f638c7/0\" alt=\"TWRP图\" /><br />\n滑动允许修改系统<br />\n点击右上的清除按钮，<br />\n滑动清除 (其实也许并不是特别需要)<br />\n 返回主页<br />\n点击安装按钮<br />\n选择之前下载的 nethunter 包<br />\n刷入<br />\n等待......(包解压时会耗费很长时间)<br />\n 最后成功<br />\n启动系统<br />\n开机动画很炫酷，内心激动不已<br />\n<img data-src=\"http://shp.qpic.cn/collector/1642981619/11490d8f-43e1-4150-aa9a-a79e20095a39/0\" alt=\"nethunter开机图\" /><br />\n开机后与原来的手机没有差别，一样的锁屏，桌面，安卓软件<br />\n唯一特殊的是多了几个特别的 APP</p>\n<h2 id=\"配置\"><a class=\"anchor\" href=\"#配置\">#</a> 配置</h2>\n<p>刷入的 kali 系统，目录在 /data/local/nhsystem/ 下面</p>\n<p>新增的安卓软件有以下几个<br />\n NetHunter      --&gt;kali 系统的控制软件<br />\n NetHunter 终端  --&gt; 命令行执行软件<br />\n Nethunter vnc  --&gt;vnc 链接软件<br />\n cSploit        --&gt; 移动端便捷的一键渗透工具<br />\n Hacker's keyboard --&gt; 键盘，并不好用<br />\n还有一些我不知道用途</p>\n<p>首先进入 nethunter 终端 弹出对话框<br />\n可以选择命令的执行端，果断选 KALI</p>\n<p>apt update 发现？？不行，需要换源<br />\n去安装目录下更改 etc/apt/sources.list<br />\n 把内容全部换掉</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"><span>sources.list</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>deb http<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>mirrors<span class=\"token punctuation\">.</span>ustc<span class=\"token punctuation\">.</span>edu<span class=\"token punctuation\">.</span>cn<span class=\"token operator\">/</span>kali kali<span class=\"token operator\">-</span>rolling main non<span class=\"token operator\">-</span>free contrib</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>deb<span class=\"token operator\">-</span>src http<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>mirrors<span class=\"token punctuation\">.</span>ustc<span class=\"token punctuation\">.</span>edu<span class=\"token punctuation\">.</span>cn<span class=\"token operator\">/</span>kali kali<span class=\"token operator\">-</span>rolling main non<span class=\"token operator\">-</span>free contrib</pre></td></tr></table></figure><p>然后运行<br />\n apt update<br />\n 如果失败请去百度搜索有关数字签名教程</p>\n<p>接下来是启动 vnc 图形页面<br />\n打开 Nethunter<br />\n 点击 VNC Manager<br />\n 点击 SETUP LOCAL SERVER<br />\n 设置密码<br />\n然后输入以下启动指令</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"><span>VNC </span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>export <span class=\"token constant\">USER</span><span class=\"token operator\">=</span>root</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>export <span class=\"token constant\">HOME</span><span class=\"token operator\">=</span><span class=\"token operator\">/</span>root</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>vncserver <span class=\"token operator\">-</span>kill <span class=\"token operator\">:</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>rm <span class=\"token operator\">-</span>rf <span class=\"token operator\">/</span>tmp<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token constant\">X1</span><span class=\"token operator\">-</span>lock</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>rm <span class=\"token operator\">-</span>rf <span class=\"token operator\">/</span>tmp<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token constant\">X11</span><span class=\"token operator\">-</span>unix<span class=\"token operator\">/</span><span class=\"token constant\">X1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>vncserver <span class=\"token operator\">-</span>name remote<span class=\"token operator\">-</span>desktop <span class=\"token operator\">:</span><span class=\"token number\">1</span></pre></td></tr></table></figure><p>打开 VNC 链接软件 (推荐去下载第三方的 vnc，nethunter vnc 不好用)<br />\n 地址: 127.0.0.1:5901<br />\n 账号: root<br />\n 密码：你设置的密码</p>\n<p>然后看到了熟悉的桌面<br />\n<img data-src=\"https://shp.qpic.cn/collector/1642981619/32a2cfd6-51e7-4fd4-ab14-e6df705e084a/0\" alt=\"kali桌面\" /></p>\n",
            "tags": [
                "linux",
                "kail",
                "渗透",
                "Android"
            ]
        },
        {
            "id": "https://pangbai.work/IT/Nowork/dialog/",
            "url": "https://pangbai.work/IT/Nowork/dialog/",
            "title": "Android底部简约风格对话框",
            "date_published": "2021-06-19T05:39:19.000Z",
            "content_html": "<p>在开发的过程中，纠结于对话框的制作，各种博客上 Android 对话框的制作教程很多，在此记录下自己制作对话框详细的过程。</p>\n<span id=\"more\"></span>\n<p>在安卓开发中，软件整体 UI 是否赏心悦目决定了用户对这个软件的评价，而对话框是用弹出的控件提醒用户操作的工具，说是 APP 的面子也不过分<br />\n我曾经在很多简约风格软件中看见过圆角的底部对话框，便感觉到了这种风格的美丽。便一直想实现它，便在网上翻找教程，但大多都是多了些复杂，而且描述并不清晰，对于我这种小白，更多带来的是头疼，经过查找资料，终于清晰了实现这种对话框的方法。<br />\n对话框可以选择 <code>Dialog</code>  或者 v7 包里的  <code>Alertdialog</code> ，使用方法和效果都差不太多<br />\n建议使用 Dialog，比起 v7 包的那一大堆东西，我更喜欢  <code>Dialog</code> <br />\n 这里将要用到的文件有</p>\n<ul>\n<li>a.java : 一个 Activity</li>\n<li>bottomdialog.xml : 对话框的布局文件</li>\n<li>translate_dialog_in.xml : 对话框进入动画</li>\n<li>translate_dialog_out.xml : 对话框关闭动画</li>\n</ul>\n<p>首先要设置对话框样式，找到项目中 value 文件夹里的  <code>style.xml</code>  并在其中添加如下代码</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"><span>style.xml</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BottomDialog<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parent</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@android:style/Theme.Dialog<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android:windowContentOverlay<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>@null<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">&lt;!-- 浮于 Activity 之上 --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android:windowIsFloating<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">&lt;!-- 边框 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android:windowFrame<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>@null<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token comment\">&lt;!-- Dialog 以外的区域模糊效果 --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android:backgroundDimEnabled<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token comment\">&lt;!-- 无标题 --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android:windowNoTitle<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">&lt;!-- 半透明 --></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android:windowIsTranslucent<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android:windowBackground<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>@android:color/transparent<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">&lt;!-- 对话框动画 --></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BottomDialog.Animation<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parent</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@android:style/Animation.Dialog<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android:windowEnterAnimation<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>@anim/translate_dialog_in<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android:windowExitAnimation<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>@anim/translate_dialog_out<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>在 res 中添加 anim 文件夹，用来存放动画<br />\n在文件夹中添加 translate_dialog_in.xml 和 translate_dialog_out.xml</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"><span>translate_dialog_in.xml</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resources</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>translate</span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>android</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://schemas.android.com/apk/res/android<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>duration</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>300<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>fromXDelta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>fromYDelta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>toXDelta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>toYDelta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100%<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>translate</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resources</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><figure class=\"highlight xml\"><figcaption data-lang=\"XML\"><span>translate_dialog_out.xml</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resources</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>translate</span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>android</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://schemas.android.com/apk/res/android<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>duration</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>300<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>fromXDelta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>fromYDelta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>toXDelta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>toYDelta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100%<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>translate</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resources</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>接下来按照你自己的需要制作底部对话框布局<br />\n我的是这样的</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"><span>bottomdialog.xml</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LinearLayout</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>android</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://schemas.android.com/apk/res/android<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>orientation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>vertical<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_gravity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_margin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>padding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>background</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@drawable/dialog_bg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LinearLayout</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>orientation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>horizontal<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>gravity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>left<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginLeft</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginRight</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginTop</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20dp<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TextView</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nowork<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textSize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>18sp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textStyle</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>bold<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textColor</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#ff000000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_gravity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginLeft</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>5dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/dtv1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LinearLayout</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LinearLayout</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>orientation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>horizontal<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>gravity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>left<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginLeft</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginRight</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginBottom</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginTop</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20dp<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TextView</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>无<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textSize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>17sp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/dtv2<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textColor</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#FF312E2E<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LinearLayout</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LinearLayout</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>orientation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>horizontal<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginLeft</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>25dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginRight</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>25dp<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LinearLayout</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>orientation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>horizontal<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>45dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_weight</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>5<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginRight</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>15dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>background</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@drawable/bdyj<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginBottom</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/dlv3<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>gravity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TextView</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>\t\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>\t\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>\t\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>取消<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>\t\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textSize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>19sp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>\t\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textColor</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#FF312E2E<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LinearLayout</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LinearLayout</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>orientation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>horizontal<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>45dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_weight</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>5<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginLeft</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>15dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>background</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@drawable/bdyj<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginBottom</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/dlv4<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>gravity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TextView</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>\t\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>\t\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>\t\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>确定<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>\t\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textSize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>19sp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>\t\t\t\t<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textColor</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#FF312E2E<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LinearLayout</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LinearLayout</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LinearLayout</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>最后只有在Activity代码里调用对话框</pre></td></tr><tr><td data-num=\"106\"></td><td><pre>```java a.java</pre></td></tr><tr><td data-num=\"107\"></td><td><pre></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>      Dialog bottomDialog = new Dialog(a.this, R.style.BottomDialog);</pre></td></tr><tr><td data-num=\"109\"></td><td><pre>      //指定布局</pre></td></tr><tr><td data-num=\"110\"></td><td><pre>View contentView = LayoutInflater.from(a.this).inflate(R.layout.bottomdialog, null);</pre></td></tr><tr><td data-num=\"111\"></td><td><pre>bottomDialog.setContentView(contentView);</pre></td></tr><tr><td data-num=\"112\"></td><td><pre>ViewGroup.LayoutParams layoutParams = contentView.getLayoutParams();</pre></td></tr><tr><td data-num=\"113\"></td><td><pre>layoutParams.width = getResources().getDisplayMetrics().widthPixels;</pre></td></tr><tr><td data-num=\"114\"></td><td><pre>contentView.setLayoutParams(layoutParams);</pre></td></tr><tr><td data-num=\"115\"></td><td><pre>//控制对话框位置</pre></td></tr><tr><td data-num=\"116\"></td><td><pre>bottomDialog.getWindow().setGravity(Gravity.BOTTOM);</pre></td></tr><tr><td data-num=\"117\"></td><td><pre>bottomDialog.getWindow().setWindowAnimations(R.style.BottomDialog_Animation);</pre></td></tr><tr><td data-num=\"118\"></td><td><pre>//显示对话框</pre></td></tr><tr><td data-num=\"119\"></td><td><pre>bottomDialog.show();</pre></td></tr></table></figure><p>以下是成品<br />\n<img data-src=\"http://shp.qpic.cn/collector/1642981619/d9076b1b-c52c-4d30-a834-5012ee76d3a1/0\" alt=\"image\" title=\"滑稽\" /></p>\n",
            "tags": [
                "Android"
            ]
        }
    ]
}