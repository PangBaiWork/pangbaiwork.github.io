---
title: CTF虚拟机
categories: 
- [ CTF ,逆向工程]
tags:
- 汇编
- Re
---
对浅显类vm题的思路总结
<!--more-->
# vm概述
vm是virtual machine的缩写，也就是虚拟机的意思。开发者把执行逻辑通过自己编写的解释器进行封装编写成自定义的代码执行。因为逻辑被封装，所以和一般汇编不一样，不可以直接阅读。任何语言都可以编写vm，即使是java(jvm里套vm，哈哈)。vm题一般较难，必须有耐心。
# vm题特征
特征一般很容易判断
- [x] 一长串的字节，他们是操作码opcode(可能是在data里，也可能是存储在单独的文件里)
- [x] 通过switch分发执行(也可以是if-else)
- [x] 有一个执行位置控制变量(ip)
# vm解题流程
- [x] 还原vm代码
vm用什么编写，那还原代码就用什么编写。需要编写出与vm题里逻辑一样的代码。可以由ida(c语言)或者jadx(java)生成的代码修改得到。
- [x] 在每行case末尾print出代码执行的逻辑
这是最重要的一步。打印的字符串尽量规范，以便于直接运行。注意识别有没有入栈出栈的代码实现。
- [x] 注释掉不必要代码
在输入错误flag情况下执行可能会出现许多问题，比如数组访问越界，控制语句导致执行退出等等。所以建议把其他代码全注释掉，只留下打印代码和改变ip的代码，如果有判断寄存器的代码，可以根据vm运行情况来注释掉判断语句。要让vm跑完所有opcode再正常退出循环。
- [x] 分析逻辑
根据打印的代码逻辑分析vm的执行情况。vm的代码很可能是使用z3约束求解进行解题的,也可能是其他逻辑，需要自行变通。